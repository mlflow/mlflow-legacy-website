
  

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MLflow Pipelines (experimental) &mdash; MLflow 1.28.0 documentation</title>
  
   
  <link rel="canonical" href="https://www.mlflow.org/docs/latest/pipelines.html">
  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    

    

  
    
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer',"GTM-N6WMTTJ");</script>
        <!-- End Google Tag Manager -->
    

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    
    <link rel="stylesheet" href="_static/css/algolia.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="MLflow 1.28.0 documentation" href="index.html"/>
        <link rel="next" title="MLflow Plugins" href="/plugins.html"/>
        <link rel="prev" title="MLflow Model Registry" href="/model-registry.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6WMTTJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="index.html" class="wy-nav-top-logo"
      ><img src="_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">1.28.0</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  
  <input id="algolia-search" type="text" name="q" placeholder="Search" />
  
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="index.html" class="main-navigation-home"><img src="_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials-and-examples/index.html">Tutorials and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">MLflow Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">MLflow Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MLflow Pipelines (experimental)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key-concepts">Key Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#steps">Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipelines-key-concept">Pipelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pipeline-repositories">Pipeline Repositories</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#profiles">Profiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reproducible-runs">Reproducible Runs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline-templates">Pipeline Templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#regression-pipeline">Regression Pipeline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="search-runs.html">Search Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="search-experiments.html">Search Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest-api.html">REST API</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.rst" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>MLflow Pipelines (experimental)</li>
    
    
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/pipelines.rst" class="fa fa-github"> Edit on GitHub</a>
    </li>
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  <div class="section" id="mlflow-pipelines-experimental">
<span id="pipelines"></span><h1>MLflow Pipelines (experimental)<a class="headerlink" href="#mlflow-pipelines-experimental" title="Permalink to this headline"> </a></h1>
<p>MLflow Pipelines is an opinionated framework for structuring MLOps workflows that simplifies and
standardizes machine learning application development and productionization. MLflow Pipelines
makes it easy for data scientists to follow best practices for creating production-ready ML
deliverables, allowing them to focus on developing excellent models. MLflow Pipelines also enables
ML engineers and DevOps teams to seamlessly deploy these models to production and incorporate them
into applications.</p>
<p>MLflow Pipelines provides production-quality <a class="reference internal" href="#pipeline-templates"><span class="std std-ref">Pipeline Templates</span></a> for
common ML problem types, such as regression &amp; classification, and MLOps tasks, such as batch
scoring. Pipelines are structured as git repositories with YAML-based configuration files and
Python code, offering developers a declarative approach to ML application development that reduces
boilerplate.</p>
<p>MLflow Pipelines also implements a cache-aware executor for <a class="reference internal" href="#steps-key-concept"><span class="std std-ref">Pipeline Steps</span></a>, ensuring that steps are only executed when associated <a class="reference internal" href="#pipeline-repositories-key-concept"><span class="std std-ref">code or
configurations</span></a> have changed. This enables data scientists,
ML engineers, and DevOps teams to iterate very quickly within their domains of expertise. MLflow
offers <a class="reference internal" href="python_api/mlflow.pipelines.html#pipelines-apis"><span class="std std-ref">APIs</span></a> and a <a class="reference internal" href="cli.html#cli"><span class="std std-ref">CLI</span></a> for executing pipelines and inspecting
their results.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"> </a></h2>
<p>MLflow Pipelines is available as an extension of the
<a class="reference external" href="https://pypi.org/project/mlflow/">MLflow Python library</a>. You can install MLflow Pipelines
from PyPI as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip install mlflow<span class="o">[</span>pipelines<span class="o">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MLflow Pipelines requires Make, which may not be preinstalled on some systems (e.g. Windows).
Please ensure Make is installed before using MLflow Pipelines.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can install MLflow Pipelines from a Databricks Notebook by running
<code class="docutils literal notranslate"><span class="pre">%pip</span> <span class="pre">install</span> <span class="pre">mlflow[pipelines]</span></code> or install MLflow Pipelines on a Databricks Cluster
by following the instructions at
<a class="reference external" href="https://docs.databricks.com/libraries/cluster-libraries.html#install-a-library-on-a-cluster">https://docs.databricks.com/libraries/cluster-libraries.html#install-a-library-on-a-cluster</a>.</p>
<p>Note that <a class="reference external" href="https://docs.databricks.com/runtime/dbr.html">Databricks Runtime</a> version 11.0
or greater is required in order to install MLflow Pipelines on Databricks.</p>
</div>
</div>
<div class="section" id="key-concepts">
<h2>Key Concepts<a class="headerlink" href="#key-concepts" title="Permalink to this headline"> </a></h2>
<div class="section" id="steps">
<span id="steps-key-concept"></span><h3>Steps<a class="headerlink" href="#steps" title="Permalink to this headline"> </a></h3>
<p>Steps represent individual modeling or MLOps procedures, such as ingesting data,
fitting an estimator, evaluating a model against test data, or deploying a model for
real-time scoring. Steps accept a collection of well-defined inputs and produce
well-defined outputs according to user-defined configurations and code. MLflow Pipelines
intelligently caches step outputs, ensuring that steps are only executed if their
inputs, code, or configurations have changed, or if such changes have occurred in dependent steps.
Steps are composed to form <a class="reference internal" href="#pipelines-key-concept"><span class="std std-ref">Pipelines</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Example Python code defining an estimator that is fit during the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline-train-step"><span class="std std-ref">train step</span></a>
of the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline"><span class="std std-ref">MLflow Regression Pipeline</span></a></span><a class="headerlink" href="#id4" title="Permalink to this code"> </a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">estimator_fn</span><span class="p">():</span>
  <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDRegressor</span>

  <span class="k">return</span> <span class="n">SGDRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Example YAML configuration defining train / validation / test dataset split
ratios for the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline-split-step"><span class="std std-ref">split step</span></a> of the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline"><span class="std std-ref">MLflow Regression Pipeline</span></a>.  This configuration demonstrates use of
<a class="reference external" href="https://jinja.palletsprojects.com">Jinja2</a> templating syntax to define a dynamic value for the <code class="docutils literal notranslate"><span class="pre">split_ratios</span></code>
attribute that can be overriden by
<a class="reference internal" href="#profiles-key-concept"><span class="std std-ref">Pipeline Profiles</span></a>.</span><a class="headerlink" href="#id5" title="Permalink to this code"> </a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">split</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Train/validation/test split ratios</span><span class="w"></span>
<span class="w">    </span><span class="nt">split_ratios</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{{</span><span class="nv">SPLIT_RATIOS|default(</span><span class="p p-Indicator">[</span><span class="nv">0.75</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.125</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.125</span><span class="p p-Indicator">]</span><span class="nv">)</span><span class="p p-Indicator">}}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pipelines-key-concept">
<span id="id1"></span><h3>Pipelines<a class="headerlink" href="#pipelines-key-concept" title="Permalink to this headline"> </a></h3>
<p>A Pipeline is a composition of <a class="reference internal" href="#steps-key-concept"><span class="std std-ref">Steps</span></a> used to solve an ML problem
or perform an MLOps task, such as developing an accurate regression model for data within a
particular domain or distributing a model to perform scalable batch inference. Pipelines
structure their code, configurations, and tests as git repositories with a standardized
directory hierarchy, as discussed in <a class="reference internal" href="#pipeline-repositories-key-concept"><span class="std std-ref">Pipeline Repositories</span></a>. MLflow Pipelines includes predefined pipeline repositories
for common ML problems and MLOps tasks called <a class="reference internal" href="#pipeline-templates"><span class="std std-ref">Pipeline Templates</span></a>.
MLflow Pipelines also provides <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow.pipelines.Pipeline" title="mlflow.pipelines.Pipeline"><code class="xref py py-class docutils literal notranslate"><span class="pre">APIs</span></code></a> and a <a class="reference internal" href="cli.html#cli"><span class="std std-ref">CLI</span></a>
for running pipelines and inspecting their results.</p>
<div class="code-section docutils container">
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Example API and CLI workflows for running the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline"><span class="std std-ref">MLflow Regression Pipeline</span></a> and inspecting results. Note that pipelines
must be run from within their corresponding git repositories.</span><a class="headerlink" href="#id6" title="Permalink to this code"> </a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mlflow.pipelines</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">mlflow.pyfunc</span> <span class="kn">import</span> <span class="n">PyFuncModel</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;~/mlp-regression-template&quot;</span><span class="p">)</span>
<span class="n">regression_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>
<span class="c1"># Run the full pipeline</span>
<span class="n">regression_pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># Inspect the model training results</span>
<span class="n">regression_pipeline</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="c1"># Load the trained model</span>
<span class="n">regression_model_pipeline</span><span class="p">:</span> <span class="n">PyFuncModel</span> <span class="o">=</span> <span class="n">regression_pipeline</span><span class="o">.</span><span class="n">get_artifact</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/mlflow/mlp-regression-template
<span class="nb">cd</span> mlp-regression-template
<span class="c1"># Run the full pipeline</span>
mlflow pipelines run --profile <span class="nb">local</span>
<span class="c1"># Inspect the model training results</span>
mlflow pipelines inspect --step train --profile <span class="nb">local</span>
<span class="c1"># Inspect the resulting model performance evaluations</span>
mlflow pipelines inspect --step evaluate --profile <span class="nb">local</span>
</pre></div>
</div>
</div>
<div class="section" id="pipeline-repositories">
<span id="pipeline-repositories-key-concept"></span><h4>Pipeline Repositories<a class="headerlink" href="#pipeline-repositories" title="Permalink to this headline"> </a></h4>
<p>Pipelines are structured as git repositories with a standardized directory hierarchy. The following
example provides an overview of the pipeline repository structure.  It is adapted from the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── pipeline.yaml
├── requirements.txt
├── steps
│   ├── ingest.py
│   ├── split.py
│   ├── transform.py
│   ├── train.py
│   ├── custom_metrics.py
├── profiles
│   ├── local.yaml
│   ├── databricks.yaml
├── tests
│   ├── ingest_test.py
│   ├── ...
│   ├── train_test.py
│   ├── ...
</pre></div>
</div>
<p>The main components of the pipeline repository layout, which are common across all pipelines, are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code>: The main pipeline configuration file that declaratively defines the
attributes and behavior of each pipeline step, such as the input dataset to use for training
a model or the performance criteria for promoting a model to production. For reference,
see the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/pipeline.yaml">pipeline.yaml</a> configuration file from the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>: A <a class="reference external" href="https://pip.pypa.io/en/stable/reference/requirements-file-format">pip requirements file</a> specifying packages
that must be installed in order to run the pipeline.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">steps</span></code>: A directory containing Python code modules used by the pipeline steps. For example,
the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a> defines the estimator type and parameters to use
when training a model in <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/train.py">steps/train.py</a> and defines custom metric computations in
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/custom_metrics.py">steps/custom_metrics.py</a>.</p></li>
</ul>
<ul class="simple" id="profiles-directory">
<li><p><code class="docutils literal notranslate"><span class="pre">profiles</span></code>: A directory containing <a class="reference internal" href="#profiles-key-concept"><span class="std std-ref">Profile</span></a> customizations for
the configurations defined in <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code>. For example, the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a> defines a <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/profiles/local.yaml">profiles/local.yaml profile</a> that
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/2751a606827259cac4508a97986fbdbc56de9ff2/profiles/local.yaml#L8">customizes the dataset used for local model development</a> and <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/2751a606827259cac4508a97986fbdbc56de9ff2/profiles/local.yaml#L1-L4">specifies a local MLflow Tracking store for logging model content</a>. The <a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a> also
defines a <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/profiles/databricks.yaml">profiles/databricks.yaml profile</a> for development on Databricks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests</span></code>: A directory containing Python test code for pipeline steps. For example, the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a> implements tests for the transformer and the estimator
defined in the respective <code class="docutils literal notranslate"><span class="pre">steps/transform.py</span></code> and <code class="docutils literal notranslate"><span class="pre">steps/train.py</span></code> modules.</p></li>
</ul>
</div></blockquote>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Shown below is an example <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/pipeline.yaml">pipeline.yaml</a> configuration file adapted from the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a>. <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code> is the main
configuration file for a pipeline containing aggregated configurations for
all pipeline steps; <a class="reference internal" href="#profiles-key-concept"><span class="std std-ref">Profile</span></a>-based substitutions and
overrides are supported using <a class="reference external" href="https://jinja.palletsprojects.com">Jinja2</a> templating syntax.</span><a class="headerlink" href="#id7" title="Permalink to this code"> </a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;regression/v1&quot;</span><span class="w"></span>
<span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{{</span><span class="nv">INGEST_DATA_LOCATION|default(&#39;https</span><span class="p p-Indicator">:</span><span class="nv">//nyc-tlc.s3.amazonaws.com/trip+data/yellow_tripdata_2022-01.parquet&#39;)</span><span class="p p-Indicator">}}</span><span class="w"></span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{{</span><span class="nv">INGEST_DATA_FORMAT|default(&#39;parquet&#39;)</span><span class="p p-Indicator">}}</span><span class="w"></span>
<span class="nt">target_col</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fare_amount&quot;</span><span class="w"></span>
<span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">split</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">split_ratios</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{{</span><span class="nv">SPLIT_RATIOS|default(</span><span class="p p-Indicator">[</span><span class="nv">0.75</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.125</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.125</span><span class="p p-Indicator">]</span><span class="nv">)</span><span class="p p-Indicator">}}</span><span class="w"></span>
<span class="w">  </span><span class="nt">transform</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">transformer_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">steps.transform.transformer_fn</span><span class="w"></span>
<span class="w">  </span><span class="nt">train</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">estimator_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">steps.train.estimator_fn</span><span class="w"></span>
<span class="w">  </span><span class="nt">evaluate</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">validation_criteria</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metric</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root_mean_squared_error</span><span class="w"></span>
<span class="w">        </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metric</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">weighted_mean_squared_error</span><span class="w"></span>
<span class="w">        </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"></span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">model_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;taxi_fare_regressor&quot;</span><span class="w"></span>
<span class="nt">metrics</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">custom</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">weighted_mean_squared_error</span><span class="w"></span>
<span class="w">      </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">weighted_mean_squared_error</span><span class="w"></span>
<span class="w">      </span><span class="nt">greater_is_better</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"></span>
<span class="w">  </span><span class="nt">primary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;root_mean_squared_error&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="profiles">
<span id="profiles-key-concept"></span><h3>Profiles<a class="headerlink" href="#profiles" title="Permalink to this headline"> </a></h3>
<p>As you develop and iterate on pipelines, you will likely need to explore a variety of configuration
and code changes to arrive at an optimal solution. For example, in the context of model training,
it is often important to experiment with different datasets, feature transformations, and model
parameters. Pipeline Profiles offer a systematic approach for incrementally testing changes in
collaborative contexts, enabling multiple team members to collaborate on the same pipeline
steps while minimizing code and configuration conflicts. Profiles also make it very easy to
customize and run pipelines across different environments, such as development, staging, and
production workspaces.</p>
<p>A profile is a collection of customizations for the configurations defined in the pipeline’s main
<a class="reference internal" href="#pipeline-repositories-key-concept"><span class="std std-ref">pipeline.yaml</span></a> file. Profiles are defined as YAML files
within the pipeline repository’s <a class="reference internal" href="#profiles-directory"><span class="std std-ref">profiles directory</span></a>. When running a
pipeline or inspecting its results, the desired profile is specified as an API or CLI argument.</p>
<div class="code-section docutils container">
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Example API and CLI workflows for running pipelines with different profile
customizations</span><a class="headerlink" href="#id8" title="Permalink to this code"> </a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mlflow.pipelines</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;~/mlp-regression-template&quot;</span><span class="p">)</span>
<span class="c1"># Run the regression pipeline to train and evaluate the performance of an ElasticNet regressor</span>
<span class="n">regression_pipeline_local_elasticnet</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s2">&quot;local-elasticnet&quot;</span><span class="p">)</span>
<span class="n">regression_pipeline_local_elasticnet</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># Run the pipeline again to train and evaluate the performance of an SGD regressor</span>
<span class="n">regression_pipeline_local_sgd</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s2">&quot;local-sgd&quot;</span><span class="p">)</span>
<span class="n">regression_pipeline_local_sgd</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># After finding the best model type and updating the &#39;shared-workspace&#39; profile accordingly,</span>
<span class="c1"># run the pipeline again to retrain the best model in a workspace where teammates can view it</span>
<span class="n">regression_pipeline_shared</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s2">&quot;shared-workspace&quot;</span><span class="p">)</span>
<span class="n">regression_pipeline_shared</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/mlflow/mlp-regression-template
<span class="nb">cd</span> mlp-regression-template
<span class="c1"># Run the regression pipeline to train and evaluate the performance of an ElasticNet regressor</span>
mlflow pipelines run --profile local-elasticnet
<span class="c1"># Run the pipeline again to train and evaluate the performance of an SGD regressor</span>
mlflow pipelines run --profile local-sgd
<span class="c1"># After finding the best model type and updating the &#39;shared-workspace&#39; profile accordingly,</span>
<span class="c1"># run the pipeline again to retrain the best model in a workspace where teammates can view it</span>
mlflow pipelines run --profile shared-workspace
</pre></div>
</div>
</div>
<p>The following profile customizations are supported:</p>
<blockquote>
<div><ul>
<li><dl>
<dt>overrides</dt><dd><ul>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code> configuration file defines a <a class="reference external" href="https://jinja.palletsprojects.com">Jinja2</a>-templated attribute with
a default value, a profile can override the value by mapping the attribute to a different
value using YAML dictionary syntax. Note that override values may have arbitrarily nested
types (e.g. lists, dictionaries, lists of dictionaries, …).</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Example <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code> configuration file defining an overrideable
<code class="docutils literal notranslate"><span class="pre">RMSE_THRESHOLD</span></code> attribute for validating model performance with a
default value of <code class="docutils literal notranslate"><span class="pre">10</span></code></span><a class="headerlink" href="#id9" title="Permalink to this code"> </a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">evaluate</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">validation_criteria</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metric</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root_mean_squared_error</span><span class="w"></span>
<span class="w">        </span><span class="c1"># The maximum RMSE value on the test dataset that a model can have</span><span class="w"></span>
<span class="w">        </span><span class="c1"># to be eligible for production deployment</span><span class="w"></span>
<span class="w">        </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{{</span><span class="nv">RMSE_THRESHOLD|default(10)</span><span class="p p-Indicator">}}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Example <code class="docutils literal notranslate"><span class="pre">prod.yaml</span></code> profile that overrides <code class="docutils literal notranslate"><span class="pre">RMSE_THRESHOLD</span></code> with
a custom value to more aggressively validate model quality for production</span><a class="headerlink" href="#id10" title="Permalink to this code"> </a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">RMSE_THRESHOLD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.2</span><span class="w"></span>
</pre></div>
</div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>substitutions</dt><dd><ul>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code> configuration file defines a <a class="reference external" href="https://jinja.palletsprojects.com">Jinja2</a>-templated attribute
without a default value, a profile <em>must</em> map the attribute to a specific value using
YAML dictionary syntax. Note that substitute values may have arbitrarily nested types
(e.g. lists, dictionaries, lists of dictionaries, …).</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Example <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code> configuration file defining a <code class="docutils literal notranslate"><span class="pre">DATASET_INFO</span></code>
variable whose value must be specified by the selected pipeline profile</span><a class="headerlink" href="#id11" title="Permalink to this code"> </a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Specifies the dataset to use for model training</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">{{</span><span class="nv">DATASET_INFO</span><span class="p p-Indicator">}}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Example <code class="docutils literal notranslate"><span class="pre">dev.yaml</span></code> profile that provides a value for <code class="docutils literal notranslate"><span class="pre">DATASET_INFO</span></code>
corresponding to a small dataset for development purposes</span><a class="headerlink" href="#id12" title="Permalink to this code"> </a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">DATASET_INFO</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/taxi-small.parquet</span><span class="w"></span>
<span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parquet</span><span class="w"></span>
</pre></div>
</div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>additions</dt><dd><ul>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code> configuration file does not define a particular attribute, a
profile may define it instead. This capability is helpful for providing values of
optional configurations that, if unspecified, a pipeline would otherwise ignore.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Example <code class="docutils literal notranslate"><span class="pre">local.yaml</span></code> profile that specifies a
<a class="reference external" href="https://www.sqlite.org/index.html">sqlite</a>-based
<a class="reference internal" href="tracking.html#tracking"><span class="std std-ref">MLflow Tracking</span></a> store for local testing on a laptop</span><a class="headerlink" href="#id13" title="Permalink to this code"> </a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">experiment</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">tracking_uri</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sqlite:///metadata/mlflow/mlruns.db&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sklearn_regression_experiment&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">artifact_location</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./metadata/mlflow/mlartifacts&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code> configuration file defines an attribute that cannot be overridden
or substituted (i.e. because its value is not specified using <a class="reference external" href="https://jinja.palletsprojects.com">Jinja2</a> templating syntax),
a profile must not define it. Defining such an attribute in a profile produces an error.</p>
</div>
</div></blockquote>
</div>
<div class="section" id="reproducible-runs">
<h3>Reproducible Runs<a class="headerlink" href="#reproducible-runs" title="Permalink to this headline"> </a></h3>
<p><a class="reference internal" href="_images/tracking_artifact_ui_for_pipeline.png"><img alt="pipelines_tracking_artifacts_img" src="_images/tracking_artifact_ui_for_pipeline.png" style="width: 55%;" /></a> <a class="reference internal" href="_images/tracking_metrics_ui_for_pipeline.png"><img alt="pipelines_tracking_metrics_img" src="_images/tracking_metrics_ui_for_pipeline.png" style="width: 44%;" /></a></p>
<p>MLflow Pipelines integrates with <a class="reference internal" href="tracking.html#tracking"><span class="std std-ref">MLflow Tracking</span></a> to provide a comprehensive,
reproducible record of pipeline runs. For example, each complete execution of the
<a class="reference internal" href="#regression-pipeline-overview"><span class="std std-ref">MLflow Regression Pipeline</span></a> creates a new
<a class="reference internal" href="tracking.html#tracking-concepts"><span class="std std-ref">MLflow Run</span></a> that records dataset profiles, the trained model, model
parameters, model performance metrics across training, validation, &amp; test datasets, model
explanations, and more.</p>
<p>Additionally, because MLflow Pipelines are structured as git repositories, it is easy to track code
and configuration changes during development and collaboratively review them with team members.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline"> </a></h2>
<p>The general workflow for using MLflow Pipelines is as follows:</p>
<ol class="arabic">
<li><p>Clone a <a class="reference internal" href="#pipeline-templates"><span class="std std-ref">Pipeline Template</span></a> git repository corresponding to the ML
problem that you want to solve or the MLOps task that you want to perform. View the template’s
README file for information about the <a class="reference internal" href="#steps-key-concept"><span class="std std-ref">Pipeline Steps</span></a> that it defines
and the results that it produces.</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">An example of cloning the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a></span><a class="headerlink" href="#id14" title="Permalink to this code"> </a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/mlflow/mlp-regression-template
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On Databricks, we recommend cloning the <a class="reference internal" href="#pipeline-templates"><span class="std std-ref">Pipeline Template</span></a> git
repository using <a class="reference external" href="https://docs.databricks.com/repos/index.html">Databricks Repos</a>.</p>
<a class="reference internal image-reference" href="_images/pipelines_databricks_repo_ui.png"><img alt="_images/pipelines_databricks_repo_ui.png" src="_images/pipelines_databricks_repo_ui.png" style="width: 60%;" /></a>
</div>
</div></blockquote>
</li>
<li><p>Run the pipeline and inspect its results. When a pipeline run completes, MLflow Pipelines
creates and displays an interactive <strong>Step Card</strong> with the results of the last executed
<a class="reference internal" href="#steps-key-concept"><span class="std std-ref">step</span></a>.</p>
<blockquote>
<div><div class="figure align-default" id="id15">
<a class="reference internal image-reference" href="_images/pipelines_evaluate_step_card.png"><img alt="_images/pipelines_evaluate_step_card.png" src="_images/pipelines_evaluate_step_card.png" style="width: 607.0px; height: 292.0px;" /></a>
<p class="caption"><span class="caption-text">An example step card produced by running the <strong>evaluate</strong> step of the
<a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline"><span class="std std-ref">MLflow Regression Pipeline</span></a>. The step card results
indicate that the trained model passed all performance validations and is ready for
registration with the <a class="reference internal" href="model-registry.html#registry"><span class="std std-ref">MLflow Model Registry</span></a>.</span><a class="headerlink" href="#id15" title="Permalink to this image"> </a></p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="code-section docutils container">
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Example API and CLI workflows for running the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline"><span class="std std-ref">Regression Pipeline</span></a> and inspecting results. Note that pipelines
must be run from within their corresponding git repositories.</span><a class="headerlink" href="#id16" title="Permalink to this code"> </a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mlflow.pipelines</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">mlflow.pyfunc</span> <span class="kn">import</span> <span class="n">PyFuncModel</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;~/mlp-regression-template&quot;</span><span class="p">)</span>
<span class="n">regression_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>
<span class="c1"># Run the full pipeline</span>
<span class="n">regression_pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="c1"># Inspect the model training results</span>
<span class="n">regression_pipeline</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="c1"># Load the trained model</span>
<span class="n">regression_model_pipeline</span><span class="p">:</span> <span class="n">PyFuncModel</span> <span class="o">=</span> <span class="n">regression_pipeline</span><span class="o">.</span><span class="n">get_artifact</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/mlflow/mlp-regression-template
<span class="nb">cd</span> mlp-regression-template
<span class="c1"># Run the full pipeline</span>
mlflow pipelines run --profile <span class="nb">local</span>
<span class="c1"># Inspect the model training results</span>
mlflow pipelines inspect --step train --profile <span class="nb">local</span>
<span class="c1"># Inspect the resulting model performance evaluations</span>
mlflow pipelines inspect --step evaluate --profile <span class="nb">local</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each <a class="reference internal" href="#pipeline-templates"><span class="std std-ref">Pipeline Template</span></a> also includes a <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/notebooks/databricks.py">Databricks Notebook</a>
and a <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/notebooks/jupyter.ipynb">Jupyter Notebook</a> for running the pipeline and inspecting its results.</p>
<p>Example pipeline run from the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/notebooks/databricks.py">Databricks Notebook</a> included in the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template">MLflow Regression Pipeline repository</a>:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="_images/pipelines_databricks_notebook_ui.png"><img alt="_images/pipelines_databricks_notebook_ui.png" src="_images/pipelines_databricks_notebook_ui.png" style="width: 726.0px; height: 605.0px;" /></a>
</div>
</div>
</div></blockquote>
</li>
<li><p>Make changes to the code and configurations in the <a class="reference internal" href="#pipeline-repositories-key-concept"><span class="std std-ref">Pipeline Repository</span></a>. Code changes are made by modifying Python modules in the
<code class="docutils literal notranslate"><span class="pre">steps</span></code> subdirectory. Configuration changes are made by editing the main <code class="docutils literal notranslate"><span class="pre">pipeline.yaml</span></code>
configuration file, as well as profile-specific configuration files in the <code class="docutils literal notranslate"><span class="pre">profiles</span></code>
subdirectory.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>When making changes to pipelines on Databricks, it is recommended that you either
edit files on your local machine and use <a class="reference external" href="https://docs.databricks.com/dev-tools/dbx.html">dbx</a> to sync them to <a class="reference external" href="https://docs.databricks.com/repos/index.html">Databricks Repos</a>,
as demonstrated below, or <a class="reference external" href="https://docs.databricks.com/repos/work-with-notebooks-other-files.html#edit-a-file">edit files in Databricks Repos</a> by opening separate browser
tabs for each YAML file or Python code module that you wish to modify.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">Example workflow for efficiently editing a pipeline on a local machine
and synchronizing changes to <a class="reference external" href="https://docs.databricks.com/repos/index.html">Databricks Repos</a></span><a class="headerlink" href="#id17" title="Permalink to this code"> </a></div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the Databricks CLI, which is used to remotely access your Databricks Workspace</span>
pip install databricks-cli
<span class="c1"># Configure remote access to your Databricks Workspace</span>
databricks configure
<span class="c1"># Install dbx, which is used to automatically sync changes to and from Databricks Repos</span>
pip install dbx
<span class="c1"># Clone the MLflow Regression Pipeline repository</span>
git clone https://github.com/mlflow/mlp-regression-template
<span class="c1"># Enter the MLflow Regression Pipeline repository directory and configure dbx within it</span>
<span class="nb">cd</span> mlp-regression-template
dbx configure
<span class="c1"># Use dbx to enable syncing from the repository directory to Databricks Repos</span>
dbx sync repo -d mlp-regression-template
<span class="c1"># Iteratively make changes to files in the repository directory and observe that they</span>
<span class="c1"># are automatically synced to Databricks Repos</span>
...
</pre></div>
</div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Test changes by running the pipeline and observing the results it produces. MLflow Pipelines
intelligently caches results from each <a class="reference internal" href="#steps-key-concept"><span class="std std-ref">Pipeline Step</span></a>, ensuring that
steps are only executed if their inputs, code, or configurations have changed, or if such
changes have occurred in dependent steps. Once you are satisfied with the results of
your changes, commit them to a branch of the <a class="reference internal" href="#pipeline-repositories-key-concept"><span class="std std-ref">Pipeline Repository</span></a> in order to ensure reproducibility, and share or review the
changes with your team.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before testing changes in a staging or production environment, it is recommended that you
commit the changes to a branch of the
<a class="reference internal" href="#pipeline-repositories-key-concept"><span class="std std-ref">Pipeline Repository</span></a> to ensure reproducibility.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, MLflow Pipelines caches results from each <a class="reference internal" href="#steps-key-concept"><span class="std std-ref">Pipeline Step</span></a> within the <code class="docutils literal notranslate"><span class="pre">.mlflow</span></code> subdirectory of the home folder on the
local filesystem. The <code class="docutils literal notranslate"><span class="pre">MLFLOW_PIPELINES_EXECUTION_DIRECTORY</span></code> environment variable can
be used to specify an alternative location for caching results.</p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="pipeline-templates">
<span id="id2"></span><h2>Pipeline Templates<a class="headerlink" href="#pipeline-templates" title="Permalink to this headline"> </a></h2>
<p>MLflow Pipelines provides extensible templates that deliver predefined solutions for common
ML problems and MLOps tasks. Each template is a fully-functional pipeline that can be easily
modified to fit your use cases. MLflow Pipelines currently offers the following extensible templates
for developing end-to-end machine learning applications:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="#regression-pipeline-overview"><span class="std std-ref">MLflow Regression Pipeline</span></a></dt><dd><ul>
<li><p>The MLflow Regression Pipeline is designed for developing high-quality regression models.
For more information, see the <a class="reference internal" href="#regression-pipeline-overview"><span class="std std-ref">Regression Pipeline overview</span></a>, the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline"><span class="std std-ref">Regression Pipeline API documentation</span></a>, and the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template">Regression Pipeline template repository</a>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Additional pipelines for a variety of ML problems and MLOps tasks are under active development.</p>
<div class="section" id="regression-pipeline">
<span id="regression-pipeline-overview"></span><h3>Regression Pipeline<a class="headerlink" href="#regression-pipeline" title="Permalink to this headline"> </a></h3>
<div class="figure align-default" id="id18">
<a class="reference internal image-reference" href="_images/regression_pipeline_dag.png"><img alt="_images/regression_pipeline_dag.png" src="_images/regression_pipeline_dag.png" style="width: 872.4px; height: 735.6px;" /></a>
<p class="caption"><span class="caption-text">A visual overview of the MLflow Regression Pipeline produced by the
<a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow.pipelines.regression.v1.pipeline.RegressionPipeline.inspect" title="mlflow.pipelines.regression.v1.pipeline.RegressionPipeline.inspect"><code class="xref py py-func docutils literal notranslate"><span class="pre">RegressionPipeline.inspect()</span></code></a> API</span><a class="headerlink" href="#id18" title="Permalink to this image"> </a></p>
</div>
<p id="mlflow-regression-pipeline">The MLflow Regression Pipeline is an MLflow Pipeline for developing high-quality regression models.
It is designed for developing models using scikit-learn and frameworks that integrate with
scikit-learn, such as the <code class="docutils literal notranslate"><span class="pre">XGBRegressor</span></code> API from XGBoost. The corresponding pipeline
template repository is available at <a class="reference external" href="https://github.com/mlflow/mlp-regression-template">https://github.com/mlflow/mlp-regression-template</a>, and the
<a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow.pipelines.regression.v1.pipeline.RegressionPipeline" title="mlflow.pipelines.regression.v1.pipeline.RegressionPipeline"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegressionPipeline</span> <span class="pre">API</span> <span class="pre">Documentation</span></code></a> provides instructions for
executing the pipeline and inspecting its results.</p>
<p>The pipeline contains the following sequential steps:</p>
<p><strong>ingest</strong> -&gt; <strong>split</strong> -&gt; <strong>transform</strong> -&gt; <strong>train</strong> -&gt; <strong>evaluate</strong> -&gt; <strong>register</strong></p>
<p>The pipeline steps are defined as follows:</p>
<blockquote>
<div><ul>
<li><dl>
<dt><strong>ingest</strong></dt><dd><ul>
<li><p>The <strong>ingest</strong> step resolves the dataset specified by the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/35f6f32c7a89dc655fbcfcf731cc1da4685a8ebb/pipeline.yaml#L15-L32">‘data’ section in pipeline.yaml</a>
and converts it to parquet format, leveraging the custom dataset parsing code defined in
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/ingest.py">steps/ingest.py</a> if necessary. Subsequent steps convert this dataset into training,
validation, &amp; test sets and use them to develop a model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you make changes to the dataset referenced by the <strong>ingest</strong> step (e.g. by adding
new records or columns), you must manually re-run the <strong>ingest</strong> step in order to
use the updated dataset in the pipeline. The <strong>ingest</strong> step does <em>not</em> automatically
detect changes in the dataset.</p>
</div>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<ul class="simple" id="mlflow-regression-pipeline-split-step">
<li><dl class="simple">
<dt><strong>split</strong></dt><dd><ul>
<li><p>The <strong>split</strong> step splits the ingested dataset produced by the <strong>ingest</strong> step into
a training dataset for model training, a validation dataset for model performance
evaluation  &amp; tuning, and a test dataset for model performance evaluation. The fraction
of records allocated to each dataset is defined by the <code class="docutils literal notranslate"><span class="pre">split_ratios</span></code> attribute of the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/35f6f32c7a89dc655fbcfcf731cc1da4685a8ebb/pipeline.yaml#L36-L40">‘split’ step definition in pipeline.yaml</a>. The <strong>split</strong> step also preprocesses the
datasets using logic defined in <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/split.py">steps/split.py</a>. Subsequent steps use these datasets
to develop a model and measure its performance.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>transform</strong></dt><dd><ul>
<li><p>The <strong>transform</strong> step uses the training dataset created by <strong>split</strong> to fit
a transformer that performs the transformations defined in <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/transform.py">steps/transform.py</a>. The
transformer is then applied to the training dataset and the validation dataset, creating
transformed datasets that are used by subsequent steps for estimator training and model
performance evaluation.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<ul id="mlflow-regression-pipeline-train-step">
<li><dl class="simple">
<dt><strong>train</strong></dt><dd><ul class="simple">
<li><p>The <strong>train</strong> step uses the transformed training dataset output from the <strong>transform</strong>
step to fit an estimator with the type and parameters defined in <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/train.py">steps/train.py</a>. The
estimator is then joined with the fitted transformer output from the <strong>transform</strong> step
to create a model pipeline. Finally, this model pipeline is evaluated against the
transformed training and validation datasets to compute performance metrics; custom
metrics are computed according to definitions in <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/custom_metrics.py">steps/custom_metrics.py</a> and the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/35f6f32c7a89dc655fbcfcf731cc1da4685a8ebb/pipeline.yaml#L64-L73">‘metrics’ section of pipeline.yaml</a>. The model pipeline and its associated parameters,
performance metrics, and lineage information are logged to MLflow Tracking, producing
an MLflow Run.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>evaluate</strong></dt><dd><ul class="simple">
<li><p>The <strong>evaluate</strong> step evaluates the model pipeline created by the <strong>train</strong> step on
the test dataset output from the <strong>split</strong> step, computing performance metrics and
model explanations. Performance metrics are compared against configured thresholds to
compute a <code class="docutils literal notranslate"><span class="pre">model_validation_status</span></code>, which indicates whether or not a model is good
enough to be registered to the MLflow Model Registry by the subsequent <strong>register</strong>
step. Custom performance metrics are computed according to definitions in
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/main/steps/custom_metrics.py">steps/custom_metrics.py</a> and the <a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/35f6f32c7a89dc655fbcfcf731cc1da4685a8ebb/pipeline.yaml#L64-L73">‘metrics’ section of pipeline.yaml</a>. Model
performance thresholds are defined in the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/35f6f32c7a89dc655fbcfcf731cc1da4685a8ebb/pipeline.yaml#L47-L56">‘validation_criteria’ section of the ‘evaluate’ step definition in pipeline.yaml</a>. Model
performance metrics and explanations are logged to the same MLflow Tracking Run used by
the <strong>train</strong> step.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>register</strong></dt><dd><ul>
<li><p>The <strong>register</strong> step checks the <code class="docutils literal notranslate"><span class="pre">model_validation_status</span></code> output of the preceding
<strong>evaluate</strong> step and, if model validation was successful
(as indicated by the <code class="docutils literal notranslate"><span class="pre">'VALIDATED'</span></code> status), registers the model pipeline created by
the <strong>train</strong> step to the MLflow Model Registry. If the <code class="docutils literal notranslate"><span class="pre">model_validation_status</span></code> does
not indicate that the model passed validation checks (i.e. its value is <code class="docutils literal notranslate"><span class="pre">'REJECTED'</span></code>),
the model pipeline is not registered to the MLflow Model Registry.
If the model pipeline is registered to the MLflow Model Registry, a
<code class="docutils literal notranslate"><span class="pre">registered_model_version</span></code> is produced containing the model name and the model version.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The model validation status check can be disabled by specifying
<code class="docutils literal notranslate"><span class="pre">allow_non_validated_model:</span> <span class="pre">true</span></code> in the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template/blob/35f6f32c7a89dc655fbcfcf731cc1da4685a8ebb/pipeline.yaml#L57-L63">‘register’ step definition of pipeline.yaml</a>, in which case the model pipeline is
always registered with the MLflow Model Registry when the <strong>register</strong> step is
executed.</p>
</div>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>For more information, see the <a class="reference internal" href="#regression-pipeline-overview"><span class="std std-ref">Regression Pipeline overview</span></a>,
the <a class="reference internal" href="python_api/mlflow.pipelines.html#mlflow-regression-pipeline"><span class="std std-ref">Regression Pipeline API documentation</span></a>, and the
<a class="reference external" href="https://github.com/mlflow/mlp-regression-template">Regression Pipeline template repository</a>.</p>
</div>
</div>
</div>


              </div>
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="model-registry.html" class="btn btn-neutral" title="MLflow Model Registry" accesskey="p"><span class="db-icon db-icon-chevron-left"></span> Previous</a>
      
      
        <a href="plugins.html" class="btn btn-neutral" title="MLflow Plugins" accesskey="n">Next <span class="db-icon db-icon-chevron-right"></span></a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'./',
      VERSION:'1.28.0',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      HAS_SOURCE:  true
    };
  </script>
  <script type="text/javascript" src="_static/jquery.js"></script>
  <script type="text/javascript" src="_static/underscore.js"></script>
  <script type="text/javascript" src="_static/doctools.js"></script>
  <script type="text/javascript" src="_static/languagesections.js"></script>
  

  <script type="text/javascript" src="_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "_static/clippy.svg";</script>
  <script type="text/javascript" src="_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
   

  
    <!-- Algolia Search -->
    <script type="text/javascript">
      var algoliaConfigs = {
        key: 'b6d79a1058f2b3c1ee03bf659ade5a4b',
        index: 'mlflow',
      };
    </script>
    <div id="algolia-wrapper"></div>
    <script src="_static/js/tether.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  
</body>
</html>