"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6163],{9052:(e,l,t)=>{t.r(l),t.d(l,{assets:()=>p,contentTitle:()=>c,default:()=>u,frontMatter:()=>m,metadata:()=>d,toc:()=>f});var o=t(4848),n=t(8453),r=t(1470),a=t(9365),i=t(493),s=t(9374);const m={sidebar_position:3},c="Deploy MLflow Model to Kubernetes",d={id:"deployment/deploy-model-to-kubernetes/index",title:"Deploy MLflow Model to Kubernetes",description:"Using MLServer as the Inference Server",source:"@site/docs/deployment/deploy-model-to-kubernetes/index.mdx",sourceDirName:"deployment/deploy-model-to-kubernetes",slug:"/deployment/deploy-model-to-kubernetes/",permalink:"/docs/latest/deployment/deploy-model-to-kubernetes/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docsSidebar",previous:{title:"Deploy MLflow Model to Amazon SageMaker",permalink:"/docs/latest/deployment/deploy-model-to-sagemaker/"},next:{title:"Develop ML model with MLflow and deploy to Kubernetes",permalink:"/docs/latest/deployment/deploy-model-to-kubernetes/tutorial/"}},p={},f=[{value:"Using MLServer as the Inference Server",id:"using-mlserver-as-the-inference-server",level:2},{value:"Deployment Steps",id:"deployment-steps",level:2},{value:"Tutorial",id:"tutorial",level:2}];function h(e){const l={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.header,{children:(0,o.jsx)(l.h1,{id:"deploy-mlflow-model-to-kubernetes",children:"Deploy MLflow Model to Kubernetes"})}),"\n",(0,o.jsx)(l.h2,{id:"using-mlserver-as-the-inference-server",children:"Using MLServer as the Inference Server"}),"\n",(0,o.jsxs)(l.p,{children:["By default, MLflow deployment uses ",(0,o.jsx)(l.a,{href:"https://flask.palletsprojects.com/en/1.1.x",children:"Flask"}),", a widely used WSGI web application framework for Python,\nto serve the inference endpoint. However, Flask is mainly designed for a lightweight application and might not be suitable for production use cases\nat scale. To address this gap, MLflow integrates with ",(0,o.jsx)(l.a,{href:"https://mlserver.readthedocs.io/en/latest",children:"MLServer"})," as an alternative deployment option, which is used\nas a core Python inference server in Kubernetes-native frameworks like ",(0,o.jsx)(l.a,{href:"https://docs.seldon.io/projects/seldon-core/en/latest",children:"Seldon Core"})," and\n",(0,o.jsx)(l.a,{href:"https://kserve.github.io/website",children:"KServe"})," (formerly known as KFServing). Using MLServer, you can take advantage of the scalability and reliability\nof Kubernetes to serve your model at scale. See ",(0,o.jsx)(l.a,{href:"/deployment/deploy-model-locally#serving_frameworks",children:"Serving Framework"})," for the detailed comparison between Flask and MLServer,\nand why MLServer is a better choice for ML production use cases."]}),"\n",(0,o.jsx)(l.h1,{id:"build-docker-for-deployment",children:"Building a Docker Image for MLflow Model"}),"\n",(0,o.jsxs)(l.p,{children:["The essential step to deploy an MLflow model to Kubernetes is to build a Docker image that contains the MLflow model and the inference server. This can be done via\n",(0,o.jsx)(l.code,{children:"build-docker"})," CLI command or Python API."]}),"\n",(0,o.jsxs)(r.A,{children:[(0,o.jsxs)(a.A,{default:!0,label:"CLI",value:"cli",children:[(0,o.jsx)(l.pre,{children:(0,o.jsx)(l.code,{className:"language-bash",children:"mlflow models build-docker -m runs:/<run_id>/model -n <image_name> --enable-mlserver\n"})}),(0,o.jsxs)(l.p,{children:["If you want to use the bare-bones Flask server instead of MLServer, remove the ",(0,o.jsx)(l.code,{children:"--enable-mlserver"})," flag. For other options, see the\n",(0,o.jsx)(l.a,{href:"/cli#mlflow-models-build-docker",children:"build-docker"})," command documentation."]})]}),(0,o.jsxs)(a.A,{label:"Python",value:"python",children:[(0,o.jsx)(l.pre,{children:(0,o.jsx)(l.code,{className:"language-python",children:'import mlflow\n\nmlflow.models.build_docker(\n    model_uri=f"runs:/{run_id}/model",\n    name="<image_name>",\n    enable_mlserver=True,\n)\n'})}),(0,o.jsxs)(l.p,{children:["If you want to use the bare-bones Flask server instead of MLServer, remove ",(0,o.jsx)(l.code,{children:"enable_mlserver=True"}),". For other options, see\nthe ",(0,o.jsx)(s.B,{fn:"mlflow.models.build_docker",children:"mlflow.models.build_docker"})," function documentation."]})]})]}),"\n",(0,o.jsx)(l.admonition,{title:"important",type:"warning",children:(0,o.jsxs)(l.p,{children:["Since MLflow 2.10.1, the Docker image spec has been changed to reduce the image size and improve the performance.\nMost notably, Java is no longer installed in the image except for the Java model flavor such as ",(0,o.jsx)(l.code,{children:"spark"}),".\nIf you need to install Java for other flavors, e.g. custom Python model that uses SparkML, please specify the ",(0,o.jsx)(l.code,{children:"--install-java"})," flag to enforce Java installation."]})}),"\n",(0,o.jsx)(l.h2,{id:"deployment-steps",children:"Deployment Steps"}),"\n",(0,o.jsx)(l.p,{children:"Please refer to the following partner documentations for deploying MLflow Models to Kubernetes using MLServer. You can also follow the tutorial below to learn the end-to-end process including environment setup, model training, and deployment."}),"\n",(0,o.jsxs)(l.ul,{children:["\n",(0,o.jsx)(l.li,{children:(0,o.jsx)(l.a,{href:"https://kserve.github.io/website/latest/modelserving/v1beta1/mlflow/v2",children:"Deploy MLflow models with KServe InferenceService"})}),"\n",(0,o.jsx)(l.li,{children:(0,o.jsx)(l.a,{href:"https://docs.seldon.io/projects/seldon-core/en/latest/servers/mlflow.html",children:"Deploy MLflow models to Seldon Core"})}),"\n"]}),"\n",(0,o.jsx)(l.h2,{id:"tutorial",children:"Tutorial"}),"\n",(0,o.jsx)(l.p,{children:"You can also learn how to train a model in MLflow and deploy to Kubernetes in the following tutorial:"}),"\n",(0,o.jsx)(i.AC,{children:(0,o.jsx)(i._C,{headerText:"Develop ML model with MLflow and deploy to Kubernetes",link:"tutorial",text:"This tutorial walks you through the end-to-end ML development process from training a machine learning mdoel, compare the performance, and deploy the model to Kubernetes using KServe."})})]})}function u(e={}){const{wrapper:l}={...(0,n.R)(),...e.components};return l?(0,o.jsx)(l,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},9365:(e,l,t)=>{t.d(l,{A:()=>a});t(6540);var o=t(4164);const n={tabItem:"tabItem_Ymn6"};var r=t(4848);function a(e){let{children:l,hidden:t,className:a}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,o.A)(n.tabItem,a),hidden:t,children:l})}},1470:(e,l,t)=>{t.d(l,{A:()=>b});var o=t(6540),n=t(4164),r=t(3104),a=t(6347),i=t(205),s=t(7485),m=t(1682),c=t(679);function d(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:l}=e;return!!l&&"object"==typeof l&&"value"in l}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:l,children:t}=e;return(0,o.useMemo)((()=>{const e=l??function(e){return d(e).map((e=>{let{props:{value:l,label:t,attributes:o,default:n}}=e;return{value:l,label:t,attributes:o,default:n}}))}(t);return function(e){const l=(0,m.XI)(e,((e,l)=>e.value===l.value));if(l.length>0)throw new Error(`Docusaurus error: Duplicate values "${l.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[l,t])}function f(e){let{value:l,tabValues:t}=e;return t.some((e=>e.value===l))}function h(e){let{queryString:l=!1,groupId:t}=e;const n=(0,a.W6)(),r=function(e){let{queryString:l=!1,groupId:t}=e;if("string"==typeof l)return l;if(!1===l)return null;if(!0===l&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:l,groupId:t});return[(0,s.aZ)(r),(0,o.useCallback)((e=>{if(!r)return;const l=new URLSearchParams(n.location.search);l.set(r,e),n.replace({...n.location,search:l.toString()})}),[r,n])]}function u(e){const{defaultValue:l,queryString:t=!1,groupId:n}=e,r=p(e),[a,s]=(0,o.useState)((()=>function(e){let{defaultValue:l,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(l){if(!f({value:l,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${l}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return l}const o=t.find((e=>e.default))??t[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:l,tabValues:r}))),[m,d]=h({queryString:t,groupId:n}),[u,w]=function(e){let{groupId:l}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(l),[n,r]=(0,c.Dv)(t);return[n,(0,o.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:n}),y=(()=>{const e=m??u;return f({value:e,tabValues:r})?e:null})();(0,i.A)((()=>{y&&s(y)}),[y]);return{selectedValue:a,selectValue:(0,o.useCallback)((e=>{if(!f({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),d(e),w(e)}),[d,w,r]),tabValues:r}}var w=t(2303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var _=t(4848);function g(e){let{className:l,block:t,selectedValue:o,selectValue:a,tabValues:i}=e;const s=[],{blockElementScrollPositionUntilNextRender:m}=(0,r.a_)(),c=e=>{const l=e.currentTarget,t=s.indexOf(l),n=i[t].value;n!==o&&(m(l),a(n))},d=e=>{let l=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=s.indexOf(e.currentTarget)+1;l=s[t]??s[0];break}case"ArrowLeft":{const t=s.indexOf(e.currentTarget)-1;l=s[t]??s[s.length-1];break}}l?.focus()};return(0,_.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":t},l),children:i.map((e=>{let{value:l,label:t,attributes:r}=e;return(0,_.jsx)("li",{role:"tab",tabIndex:o===l?0:-1,"aria-selected":o===l,ref:e=>s.push(e),onKeyDown:d,onClick:c,...r,className:(0,n.A)("tabs__item",y.tabItem,r?.className,{"tabs__item--active":o===l}),children:t??l},l)}))})}function v(e){let{lazy:l,children:t,selectedValue:r}=e;const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(l){const e=a.find((e=>e.props.value===r));return e?(0,o.cloneElement)(e,{className:(0,n.A)("margin-top--md",e.props.className)}):null}return(0,_.jsx)("div",{className:"margin-top--md",children:a.map(((e,l)=>(0,o.cloneElement)(e,{key:l,hidden:e.props.value!==r})))})}function x(e){const l=u(e);return(0,_.jsxs)("div",{className:(0,n.A)("tabs-container",y.tabList),children:[(0,_.jsx)(g,{...l,...e}),(0,_.jsx)(v,{...l,...e})]})}function b(e){const l=(0,w.A)();return(0,_.jsx)(x,{...e,children:d(e.children)},String(l))}},9374:(e,l,t)=>{t.d(l,{B:()=>s});t(6540);const o=JSON.parse('{"mlflow.artifacts":"api_reference/python_api/mlflow.artifacts.html","mlflow.autogen":"api_reference/python_api/mlflow.autogen.html","mlflow.catboost":"api_reference/python_api/mlflow.catboost.html","mlflow.client":"api_reference/python_api/mlflow.client.html","mlflow.config":"api_reference/python_api/mlflow.config.html","mlflow.data":"api_reference/python_api/mlflow.data.html","mlflow.deployments":"api_reference/python_api/mlflow.deployments.html","mlflow.diviner":"api_reference/python_api/mlflow.diviner.html","mlflow.dspy":"api_reference/python_api/mlflow.dspy.html","mlflow.entities":"api_reference/python_api/mlflow.entities.html","mlflow.environment_variables":"api_reference/python_api/mlflow.environment_variables.html","mlflow.fastai":"api_reference/python_api/mlflow.fastai.html","mlflow.gateway":"api_reference/python_api/mlflow.gateway.html","mlflow.gemini":"api_reference/python_api/mlflow.gemini.html","mlflow.gluon":"api_reference/python_api/mlflow.gluon.html","mlflow.h2o":"api_reference/python_api/mlflow.h2o.html","mlflow.johnsnowlabs":"api_reference/python_api/mlflow.johnsnowlabs.html","mlflow.keras":"api_reference/python_api/mlflow.keras.html","mlflow.langchain":"api_reference/python_api/mlflow.langchain.html","mlflow.lightgbm":"api_reference/python_api/mlflow.lightgbm.html","mlflow.litellm":"api_reference/python_api/mlflow.litellm.html","mlflow.llama_index":"api_reference/python_api/mlflow.llama_index.html","mlflow.metrics":"api_reference/python_api/mlflow.metrics.html","mlflow.mleap":"api_reference/python_api/mlflow.mleap.html","mlflow.models":"api_reference/python_api/mlflow.models.html","mlflow.onnx":"api_reference/python_api/mlflow.onnx.html","mlflow.openai":"api_reference/python_api/mlflow.openai.html","mlflow.paddle":"api_reference/python_api/mlflow.paddle.html","mlflow.pmdarima":"api_reference/python_api/mlflow.pmdarima.html","mlflow.projects":"api_reference/python_api/mlflow.projects.html","mlflow.promptflow":"api_reference/python_api/mlflow.promptflow.html","mlflow.prophet":"api_reference/python_api/mlflow.prophet.html","mlflow.pyfunc":"api_reference/python_api/mlflow.pyfunc.html","mlflow.pyspark.ml":"api_reference/python_api/mlflow.pyspark.ml.html","mlflow.pytorch":"api_reference/python_api/mlflow.pytorch.html","mlflow.recipes":"api_reference/python_api/mlflow.recipes.html","mlflow":"api_reference/python_api/mlflow.html","mlflow.sagemaker":"api_reference/python_api/mlflow.sagemaker.html","mlflow.sentence_transformers":"api_reference/python_api/mlflow.sentence_transformers.html","mlflow.server":"api_reference/python_api/mlflow.server.html","mlflow.shap":"api_reference/python_api/mlflow.shap.html","mlflow.sklearn":"api_reference/python_api/mlflow.sklearn.html","mlflow.spacy":"api_reference/python_api/mlflow.spacy.html","mlflow.spark":"api_reference/python_api/mlflow.spark.html","mlflow.statsmodels":"api_reference/python_api/mlflow.statsmodels.html","mlflow.system_metrics":"api_reference/python_api/mlflow.system_metrics.html","mlflow.tensorflow":"api_reference/python_api/mlflow.tensorflow.html","mlflow.tracing":"api_reference/python_api/mlflow.tracing.html","mlflow.transformers":"api_reference/python_api/mlflow.transformers.html","mlflow.types":"api_reference/python_api/mlflow.types.html","mlflow.utils":"api_reference/python_api/mlflow.utils.html","mlflow.xgboost":"api_reference/python_api/mlflow.xgboost.html"}');var n=t(6025),r=t(8774),a=t(4848);const i=e=>{const l=e.split(".");for(let t=l.length;t>0;t--){const e=l.slice(0,t).join(".");if(o[e])return e}return null};function s(e){let{fn:l,children:t}=e;const s=i(l);if(!s)return(0,a.jsx)(a.Fragment,{children:t});const m=(0,n.Ay)(`/${o[s]}#${l}`);return(0,a.jsx)(r.A,{to:m,target:"_blank",children:t??(0,a.jsxs)("code",{children:[l,"()"]})})}},493:(e,l,t)=>{t.d(l,{Zp:()=>s,AC:()=>i,WO:()=>c,_C:()=>m,$3:()=>d});var o=t(4164);const n={CardGroup:"CardGroup_P84T",MaxThreeColumns:"MaxThreeColumns_FO1r",AutofillColumns:"AutofillColumns_fKhQ",Card:"Card_aSCR",CardBordered:"CardBordered_glGF",CardBody:"CardBody_BhRs",TextColor:"TextColor_a8Tp",BoxRoot:"BoxRoot_Etgr",FlexWrapNowrap:"FlexWrapNowrap_f60k",FlexJustifyContentFlexStart:"FlexJustifyContentFlexStart_ZYv5",FlexDirectionRow:"FlexDirectionRow_T2qL",FlexAlignItemsCenter:"FlexAlignItemsCenter_EHVM",FlexFlex:"FlexFlex__JTE",Link:"Link_fVkl",MarginLeft4:"MarginLeft4_YQSJ",MarginTop4:"MarginTop4_jXKN",PaddingBottom4:"PaddingBottom4_O9gt",LogoCardContent:"LogoCardContent_kCQm",LogoCardImage:"LogoCardImage_JdcX",SmallLogoCardContent:"SmallLogoCardContent_LxhV",SmallLogoCardImage:"SmallLogoCardImage_tPZl"};var r=t(8774),a=t(4848);const i=e=>{let{children:l,isSmall:t}=e;return(0,a.jsx)("div",{className:(0,o.A)(n.CardGroup,t?n.AutofillColumns:n.MaxThreeColumns),children:l})},s=e=>{let{children:l,link:t}=e;return(0,a.jsx)(r.A,{className:(0,o.A)(n.Link,n.Card,n.CardBordered),to:t,children:l})},m=e=>{let{headerText:l,link:t,text:r}=e;return(0,a.jsx)(s,{link:t,children:(0,a.jsxs)("span",{children:[(0,a.jsx)("div",{className:(0,o.A)(n.CardTitle,n.BoxRoot,n.PaddingBottom4),style:{pointerEvents:"none"},children:(0,a.jsx)("div",{className:(0,o.A)(n.BoxRoot,n.FlexFlex,n.FlexAlignItemsCenter,n.FlexDirectionRow,n.FlexJustifyContentFlexStart,n.FlexWrapNowrap),style:{marginLeft:"-4px",marginTop:"-4px"},children:(0,a.jsx)("div",{className:(0,o.A)(n.BoxRoot,n.BoxHideIfEmpty,n.MarginTop4,n.MarginLeft4),style:{pointerEvents:"auto"},children:(0,a.jsx)("span",{className:"",children:l})})})}),(0,a.jsx)("span",{className:(0,o.A)(n.TextColor,n.CardBody),children:(0,a.jsx)("p",{children:r})})]})})},c=e=>{let{description:l,children:t,link:o}=e;return(0,a.jsx)(s,{link:o,children:(0,a.jsxs)("div",{className:n.LogoCardContent,children:[(0,a.jsx)("div",{className:n.LogoCardImage,children:t}),(0,a.jsx)("p",{className:n.TextColor,children:l})]})})},d=e=>{let{children:l,link:t}=e;return(0,a.jsx)(s,{link:t,children:(0,a.jsx)("div",{className:n.SmallLogoCardContent,children:(0,a.jsx)("div",{className:(0,o.A)("max-height-img-container",n.SmallLogoCardImage),children:l})})})}},8453:(e,l,t)=>{t.d(l,{R:()=>a,x:()=>i});var o=t(6540);const n={},r=o.createContext(n);function a(e){const l=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function i(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),o.createElement(r.Provider,{value:l},e.children)}}}]);