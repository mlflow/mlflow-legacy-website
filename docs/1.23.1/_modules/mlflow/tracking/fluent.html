
  

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mlflow.tracking.fluent</title>
  
   
  <link rel="canonical" href="https://www.mlflow.org/docs/latest/_modules/mlflow/tracking/fluent.html">
  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    

    

  
    
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-WXWDBL');</script>
      

  

  
  
    

  

  
  
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    
    <link rel="stylesheet" href="../../../_static/css/algolia.css" type="text/css" />
    
  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="MLflow 1.23.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  

  
  <nav class="wy-nav-top header" role="navigation" aria-label="top navigation">
    <ul>
  <li class="menu-toggle">
    <i data-toggle="wy-nav-top" class="wy-nav-top-menu-button db-icon db-icon-menu pull-left"></i>
    <a href="../../../index.html" class="wy-nav-top-logo"
      ><img src="../../../_static/MLflow-logo-final-black.png" alt="MLflow"
    /></a>
    <span class="version">1.23.1</span>
  </li>
</ul>
  </nav>
  <page>
    

    <nav data-toggle="wy-nav-shift" class="wy-nav-side relative">
      <div class="wy-side-scroll">
  <div class="wy-side-nav-search">
    

    

    
<div role="search">
  
  <input id="algolia-search" type="text" name="q" placeholder="Search" />
  
</div>


    
  </div>

  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      <a href="../../../index.html" class="main-navigation-home"><img src="../../../_static/icons/nav-home.svg"> MLflow</a>
    

    
      

      
        <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials-and-examples/index.html">Tutorials and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tracking.html">MLflow Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projects.html">MLflow Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.html">MLflow Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model-registry.html">MLflow Model Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins.html">MLflow Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../search-syntax.html">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../R-api.html">R API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../java_api/index.html">Java API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rest-api.html">REST API</a></li>
</ul>

      
    
  </div>

  <div role="contentinfo">
    

    <p>
      <a id='feedbacklink' href="https://github.com/mlflow/mlflow/blob/master/CONTRIBUTING.rst" target="_blank">Contribute</a>
    </p>
  </div>
</div>
    </nav>

    <main class="wy-grid-for-nav">
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <div class="wy-nav-content">
          <div class="rst-content">
            










<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Documentation</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
        <li><a href="../../index.html">Module code</a> <span class="db-icon db-icon-chevron-right"></span></li>
    
    
      <li>mlflow.tracking.fluent</li>
    
    
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/mlflow/mlflow/blob/master/docs/source/_modules/mlflow/tracking/fluent" class="fa fa-github"> Edit on GitHub</a>
    </li>
    
  </ul>
</div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                
  <h1>Source code for mlflow.tracking.fluent</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Internal module implementing the fluent API, allowing management of an active</span>
<span class="sd">MLflow run. This module is exposed to users at the top-level :py:mod:`mlflow` module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">packaging.version</span> <span class="kn">import</span> <span class="n">Version</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">from</span> <span class="nn">mlflow.entities</span> <span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">Run</span><span class="p">,</span> <span class="n">RunInfo</span><span class="p">,</span> <span class="n">RunStatus</span><span class="p">,</span> <span class="n">Param</span><span class="p">,</span> <span class="n">RunTag</span><span class="p">,</span> <span class="n">Metric</span><span class="p">,</span> <span class="n">ViewType</span>
<span class="kn">from</span> <span class="nn">mlflow.entities.lifecycle_stage</span> <span class="kn">import</span> <span class="n">LifecycleStage</span>
<span class="kn">from</span> <span class="nn">mlflow.exceptions</span> <span class="kn">import</span> <span class="n">MlflowException</span>
<span class="kn">from</span> <span class="nn">mlflow.protos.databricks_pb2</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">INVALID_PARAMETER_VALUE</span><span class="p">,</span>
    <span class="n">RESOURCE_DOES_NOT_EXIST</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">mlflow.tracking.client</span> <span class="kn">import</span> <span class="n">MlflowClient</span>
<span class="kn">from</span> <span class="nn">mlflow.tracking</span> <span class="kn">import</span> <span class="n">artifact_utils</span><span class="p">,</span> <span class="n">_get_store</span>
<span class="kn">from</span> <span class="nn">mlflow.tracking.context</span> <span class="kn">import</span> <span class="n">registry</span> <span class="k">as</span> <span class="n">context_registry</span>
<span class="kn">from</span> <span class="nn">mlflow.store.tracking</span> <span class="kn">import</span> <span class="n">SEARCH_MAX_RESULTS_DEFAULT</span>
<span class="kn">from</span> <span class="nn">mlflow.utils</span> <span class="kn">import</span> <span class="n">env</span>
<span class="kn">from</span> <span class="nn">mlflow.utils.autologging_utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_testing</span><span class="p">,</span>
    <span class="n">autologging_integration</span><span class="p">,</span>
    <span class="n">AUTOLOGGING_INTEGRATIONS</span><span class="p">,</span>
    <span class="n">autologging_is_disabled</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">mlflow.utils.databricks_utils</span> <span class="kn">import</span> <span class="n">is_in_databricks_notebook</span><span class="p">,</span> <span class="n">get_notebook_id</span>
<span class="kn">from</span> <span class="nn">mlflow.utils.import_hooks</span> <span class="kn">import</span> <span class="n">register_post_import_hook</span>
<span class="kn">from</span> <span class="nn">mlflow.utils.mlflow_tags</span> <span class="kn">import</span> <span class="n">MLFLOW_PARENT_RUN_ID</span><span class="p">,</span> <span class="n">MLFLOW_RUN_NAME</span>
<span class="kn">from</span> <span class="nn">mlflow.utils.validation</span> <span class="kn">import</span> <span class="n">_validate_run_id</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span>  <span class="c1"># pylint: disable=unused-import</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>  <span class="c1"># pylint: disable=unused-import</span>
    <span class="kn">import</span> <span class="nn">plotly</span>  <span class="c1"># pylint: disable=unused-import</span>
    <span class="kn">import</span> <span class="nn">numpy</span>  <span class="c1"># pylint: disable=unused-import</span>
    <span class="kn">import</span> <span class="nn">PIL</span>  <span class="c1"># pylint: disable=unused-import</span>


<span class="n">_EXPERIMENT_ID_ENV_VAR</span> <span class="o">=</span> <span class="s2">&quot;MLFLOW_EXPERIMENT_ID&quot;</span>
<span class="n">_EXPERIMENT_NAME_ENV_VAR</span> <span class="o">=</span> <span class="s2">&quot;MLFLOW_EXPERIMENT_NAME&quot;</span>
<span class="n">_RUN_ID_ENV_VAR</span> <span class="o">=</span> <span class="s2">&quot;MLFLOW_RUN_ID&quot;</span>
<span class="n">_active_run_stack</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">_active_experiment_id</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">SEARCH_MAX_RESULTS_PANDAS</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">NUM_RUNS_PER_PAGE_PANDAS</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="set_experiment"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.set_experiment">[docs]</a><span class="k">def</span> <span class="nf">set_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">experiment_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the given experiment as the active experiment. The experiment must either be specified by</span>
<span class="sd">    name via `experiment_name` or by ID via `experiment_id`. The experiment name and ID cannot</span>
<span class="sd">    both be specified.</span>

<span class="sd">    :param experiment_name: Case sensitive name of the experiment to be activated. If an experiment</span>
<span class="sd">                            with this name does not exist, a new experiment wth this name is</span>
<span class="sd">                            created.</span>
<span class="sd">    :param experiment_id: ID of the experiment to be activated. If an experiment with this ID</span>
<span class="sd">                          does not exist, an exception is thrown.</span>
<span class="sd">    :return: An instance of :py:class:`mlflow.entities.Experiment` representing the new active</span>
<span class="sd">             experiment.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        # Set an experiment name, which must be unique and case sensitive.</span>
<span class="sd">        mlflow.set_experiment(&quot;Social NLP Experiments&quot;)</span>

<span class="sd">        # Get Experiment Details</span>
<span class="sd">        experiment = mlflow.get_experiment_by_name(&quot;Social NLP Experiments&quot;)</span>
<span class="sd">        print(&quot;Experiment_id: {}&quot;.format(experiment.experiment_id))</span>
<span class="sd">        print(&quot;Artifact Location: {}&quot;.format(experiment.artifact_location))</span>
<span class="sd">        print(&quot;Tags: {}&quot;.format(experiment.tags))</span>
<span class="sd">        print(&quot;Lifecycle_stage: {}&quot;.format(experiment.lifecycle_stage))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Experiment_id: 1</span>
<span class="sd">        Artifact Location: file:///.../mlruns/1</span>
<span class="sd">        Tags: {}</span>
<span class="sd">        Lifecycle_stage: active</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">experiment_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">experiment_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="n">MlflowException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Must specify exactly one of: `experiment_id` or `experiment_name`.&quot;</span><span class="p">,</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">INVALID_PARAMETER_VALUE</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">MlflowClient</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">experiment</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Experiment with name &#39;</span><span class="si">%s</span><span class="s2">&#39; does not exist. Creating a new experiment.&quot;</span><span class="p">,</span>
                <span class="n">experiment_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># NB: If two simultaneous threads or processes attempt to set the same experiment</span>
            <span class="c1"># simultaneously, a race condition may be encountered here wherein experiment creation</span>
            <span class="c1"># fails</span>
            <span class="n">experiment_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>
            <span class="n">experiment</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_experiment</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_experiment</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">experiment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MlflowException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Experiment with ID &#39;</span><span class="si">{</span><span class="n">experiment_id</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="n">RESOURCE_DOES_NOT_EXIST</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">experiment</span><span class="o">.</span><span class="n">lifecycle_stage</span> <span class="o">!=</span> <span class="n">LifecycleStage</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MlflowException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;Cannot set a deleted experiment &#39;</span><span class="si">%s</span><span class="s2">&#39; as the active experiment.&quot;</span>
                <span class="s2">&quot; You can restore the experiment, or permanently delete the &quot;</span>
                <span class="s2">&quot; experiment to create a new one.&quot;</span> <span class="o">%</span> <span class="n">experiment</span><span class="o">.</span><span class="n">name</span>
            <span class="p">),</span>
            <span class="n">error_code</span><span class="o">=</span><span class="n">INVALID_PARAMETER_VALUE</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">global</span> <span class="n">_active_experiment_id</span>
    <span class="n">_active_experiment_id</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">experiment_id</span>
    <span class="k">return</span> <span class="n">experiment</span></div>


<div class="viewcode-block" id="ActiveRun"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.ActiveRun">[docs]</a><span class="k">class</span> <span class="nc">ActiveRun</span><span class="p">(</span><span class="n">Run</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0223</span>
    <span class="sd">&quot;&quot;&quot;Wrapper around :py:class:`mlflow.entities.Run` to enable using Python ``with`` syntax.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">):</span>
        <span class="n">Run</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">RunStatus</span><span class="o">.</span><span class="n">FINISHED</span> <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">RunStatus</span><span class="o">.</span><span class="n">FAILED</span>
        <span class="n">end_run</span><span class="p">(</span><span class="n">RunStatus</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="start_run"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.start_run">[docs]</a><span class="k">def</span> <span class="nf">start_run</span><span class="p">(</span>
    <span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">experiment_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">run_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nested</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActiveRun</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start a new MLflow run, setting it as the active run under which metrics and parameters</span>
<span class="sd">    will be logged. The return value can be used as a context manager within a ``with`` block;</span>
<span class="sd">    otherwise, you must call ``end_run()`` to terminate the current run.</span>

<span class="sd">    If you pass a ``run_id`` or the ``MLFLOW_RUN_ID`` environment variable is set,</span>
<span class="sd">    ``start_run`` attempts to resume a run with the specified run ID and</span>
<span class="sd">    other parameters are ignored. ``run_id`` takes precedence over ``MLFLOW_RUN_ID``.</span>

<span class="sd">    If resuming an existing run, the run status is set to ``RunStatus.RUNNING``.</span>

<span class="sd">    MLflow sets a variety of default tags on the run, as defined in</span>
<span class="sd">    :ref:`MLflow system tags &lt;system_tags&gt;`.</span>

<span class="sd">    :param run_id: If specified, get the run with the specified UUID and log parameters</span>
<span class="sd">                     and metrics under that run. The run&#39;s end time is unset and its status</span>
<span class="sd">                     is set to running, but the run&#39;s other attributes (``source_version``,</span>
<span class="sd">                     ``source_type``, etc.) are not changed.</span>
<span class="sd">    :param experiment_id: ID of the experiment under which to create the current run (applicable</span>
<span class="sd">                          only when ``run_id`` is not specified). If ``experiment_id`` argument</span>
<span class="sd">                          is unspecified, will look for valid experiment in the following order:</span>
<span class="sd">                          activated using ``set_experiment``, ``MLFLOW_EXPERIMENT_NAME``</span>
<span class="sd">                          environment variable, ``MLFLOW_EXPERIMENT_ID`` environment variable,</span>
<span class="sd">                          or the default experiment as defined by the tracking server.</span>
<span class="sd">    :param run_name: Name of new run (stored as a ``mlflow.runName`` tag).</span>
<span class="sd">                     Used only when ``run_id`` is unspecified.</span>
<span class="sd">    :param nested: Controls whether run is nested in parent run. ``True`` creates a nested run.</span>
<span class="sd">    :param tags: An optional dictionary of string keys and values to set as tags on the run.</span>
<span class="sd">                 If a run is being resumed, these tags are set on the resumed run. If a new run is</span>
<span class="sd">                 being created, these tags are set on the new run.</span>
<span class="sd">    :return: :py:class:`mlflow.ActiveRun` object that acts as a context manager wrapping</span>
<span class="sd">             the run&#39;s state.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        # Create nested runs</span>
<span class="sd">        with mlflow.start_run(run_name=&#39;PARENT_RUN&#39;) as parent_run:</span>
<span class="sd">            mlflow.log_param(&quot;parent&quot;, &quot;yes&quot;)</span>
<span class="sd">            with mlflow.start_run(run_name=&#39;CHILD_RUN&#39;, nested=True) as child_run:</span>
<span class="sd">                mlflow.log_param(&quot;child&quot;, &quot;yes&quot;)</span>

<span class="sd">        print(&quot;parent run_id: {}&quot;.format(parent_run.info.run_id))</span>
<span class="sd">        print(&quot;child run_id : {}&quot;.format(child_run.info.run_id))</span>
<span class="sd">        print(&quot;--&quot;)</span>

<span class="sd">        # Search all child runs with a parent id</span>
<span class="sd">        query = &quot;tags.mlflow.parentRunId = &#39;{}&#39;&quot;.format(parent_run.info.run_id)</span>
<span class="sd">        results = mlflow.search_runs(filter_string=query)</span>
<span class="sd">        print(results[[&quot;run_id&quot;, &quot;params.child&quot;, &quot;tags.mlflow.runName&quot;]])</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        parent run_id: 5ec0e7ae18f54c2694ffb48c2fccf25c</span>
<span class="sd">        child run_id : 78b3b0d264b44cd29e8dc389749bb4be</span>
<span class="sd">        --</span>
<span class="sd">                                     run_id params.child tags.mlflow.runName</span>
<span class="sd">        0  78b3b0d264b44cd29e8dc389749bb4be          yes           CHILD_RUN</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_active_run_stack</span>
    <span class="c1"># back compat for int experiment_id</span>
    <span class="n">experiment_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">experiment_id</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_active_run_stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nested</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;Run with UUID </span><span class="si">{}</span><span class="s2"> is already active. To start a new run, first end the &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;current run with mlflow.end_run(). To start a nested &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;run, call start_run with nested=True&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_active_run_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">MlflowClient</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">run_id</span><span class="p">:</span>
        <span class="n">existing_run_id</span> <span class="o">=</span> <span class="n">run_id</span>
    <span class="k">elif</span> <span class="n">_RUN_ID_ENV_VAR</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">existing_run_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">_RUN_ID_ENV_VAR</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">_RUN_ID_ENV_VAR</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">existing_run_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">existing_run_id</span><span class="p">:</span>
        <span class="n">_validate_run_id</span><span class="p">(</span><span class="n">existing_run_id</span><span class="p">)</span>
        <span class="n">active_run_obj</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">existing_run_id</span><span class="p">)</span>
        <span class="c1"># Check to see if experiment_id from environment matches experiment_id from set_experiment()</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">_active_experiment_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">_active_experiment_id</span> <span class="o">!=</span> <span class="n">active_run_obj</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">experiment_id</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">MlflowException</span><span class="p">(</span>
                <span class="s2">&quot;Cannot start run with ID </span><span class="si">{}</span><span class="s2"> because active run ID &quot;</span>
                <span class="s2">&quot;does not match environment run ID. Make sure --experiment-name &quot;</span>
                <span class="s2">&quot;or --experiment-id matches experiment set with &quot;</span>
                <span class="s2">&quot;set_experiment(), or just use command-line &quot;</span>
                <span class="s2">&quot;arguments&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">existing_run_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># Check to see if current run isn&#39;t deleted</span>
        <span class="k">if</span> <span class="n">active_run_obj</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">lifecycle_stage</span> <span class="o">==</span> <span class="n">LifecycleStage</span><span class="o">.</span><span class="n">DELETED</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MlflowException</span><span class="p">(</span>
                <span class="s2">&quot;Cannot start run with ID </span><span class="si">{}</span><span class="s2"> because it is in the &quot;</span>
                <span class="s2">&quot;deleted state.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">existing_run_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># Use previous end_time because a value is required for update_run_info</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">active_run_obj</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">end_time</span>
        <span class="n">_get_store</span><span class="p">()</span><span class="o">.</span><span class="n">update_run_info</span><span class="p">(</span>
            <span class="n">existing_run_id</span><span class="p">,</span> <span class="n">run_status</span><span class="o">=</span><span class="n">RunStatus</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">log_batch</span><span class="p">(</span>
                <span class="n">run_id</span><span class="o">=</span><span class="n">existing_run_id</span><span class="p">,</span>
                <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="n">RunTag</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
            <span class="p">)</span>
        <span class="n">active_run_obj</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">existing_run_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_active_run_stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parent_run_id</span> <span class="o">=</span> <span class="n">_active_run_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_run_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">exp_id_for_run</span> <span class="o">=</span> <span class="n">experiment_id</span> <span class="k">if</span> <span class="n">experiment_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_get_experiment_id</span><span class="p">()</span>

        <span class="n">user_specified_tags</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">parent_run_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user_specified_tags</span><span class="p">[</span><span class="n">MLFLOW_PARENT_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_run_id</span>
        <span class="k">if</span> <span class="n">run_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user_specified_tags</span><span class="p">[</span><span class="n">MLFLOW_RUN_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_name</span>

        <span class="n">resolved_tags</span> <span class="o">=</span> <span class="n">context_registry</span><span class="o">.</span><span class="n">resolve_tags</span><span class="p">(</span><span class="n">user_specified_tags</span><span class="p">)</span>

        <span class="n">active_run_obj</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_run</span><span class="p">(</span><span class="n">experiment_id</span><span class="o">=</span><span class="n">exp_id_for_run</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">resolved_tags</span><span class="p">)</span>

    <span class="n">_active_run_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ActiveRun</span><span class="p">(</span><span class="n">active_run_obj</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_active_run_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="end_run"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.end_run">[docs]</a><span class="k">def</span> <span class="nf">end_run</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RunStatus</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">RunStatus</span><span class="o">.</span><span class="n">FINISHED</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;End an active MLflow run (if there is one).</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        # Start run and get status</span>
<span class="sd">        mlflow.start_run()</span>
<span class="sd">        run = mlflow.active_run()</span>
<span class="sd">        print(&quot;run_id: {}; status: {}&quot;.format(run.info.run_id, run.info.status))</span>

<span class="sd">        # End run and get status</span>
<span class="sd">        mlflow.end_run()</span>
<span class="sd">        run = mlflow.get_run(run.info.run_id)</span>
<span class="sd">        print(&quot;run_id: {}; status: {}&quot;.format(run.info.run_id, run.info.status))</span>
<span class="sd">        print(&quot;--&quot;)</span>

<span class="sd">        # Check for any active runs</span>
<span class="sd">        print(&quot;Active run: {}&quot;.format(mlflow.active_run()))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        run_id: b47ee4563368419880b44ad8535f6371; status: RUNNING</span>
<span class="sd">        run_id: b47ee4563368419880b44ad8535f6371; status: FINISHED</span>
<span class="sd">        --</span>
<span class="sd">        Active run: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_active_run_stack</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_active_run_stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Clear out the global existing run environment variable as well.</span>
        <span class="n">env</span><span class="o">.</span><span class="n">unset_variable</span><span class="p">(</span><span class="n">_RUN_ID_ENV_VAR</span><span class="p">)</span>
        <span class="n">run</span> <span class="o">=</span> <span class="n">_active_run_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">set_terminated</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span></div>


<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">end_run</span><span class="p">)</span>


<div class="viewcode-block" id="active_run"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.active_run">[docs]</a><span class="k">def</span> <span class="nf">active_run</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ActiveRun</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get the currently active ``Run``, or None if no such run exists.</span>

<span class="sd">    **Note**: You cannot access currently-active run attributes</span>
<span class="sd">    (parameters, metrics, etc.) through the run returned by ``mlflow.active_run``. In order</span>
<span class="sd">    to access such attributes, use the :py:class:`mlflow.tracking.MlflowClient` as follows:</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        mlflow.start_run()</span>
<span class="sd">        run = mlflow.active_run()</span>
<span class="sd">        print(&quot;Active run_id: {}&quot;.format(run.info.run_id))</span>
<span class="sd">        mlflow.end_run()</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Active run_id: 6f252757005748708cd3aad75d1ff462</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_active_run_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_active_run_stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="get_run"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.get_run">[docs]</a><span class="k">def</span> <span class="nf">get_run</span><span class="p">(</span><span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Run</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch the run from backend store. The resulting :py:class:`Run &lt;mlflow.entities.Run&gt;`</span>
<span class="sd">    contains a collection of run metadata -- :py:class:`RunInfo &lt;mlflow.entities.RunInfo&gt;`,</span>
<span class="sd">    as well as a collection of run parameters, tags, and metrics --</span>
<span class="sd">    :py:class:`RunData &lt;mlflow.entities.RunData&gt;`. In the case where multiple metrics with the</span>
<span class="sd">    same key are logged for the run, the :py:class:`RunData &lt;mlflow.entities.RunData&gt;` contains</span>
<span class="sd">    the most recently logged value at the largest step for each metric.</span>

<span class="sd">    :param run_id: Unique identifier for the run.</span>

<span class="sd">    :return: A single :py:class:`mlflow.entities.Run` object, if the run exists. Otherwise,</span>
<span class="sd">                raises an exception.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        with mlflow.start_run() as run:</span>
<span class="sd">            mlflow.log_param(&quot;p&quot;, 0)</span>

<span class="sd">        run_id = run.info.run_id</span>
<span class="sd">        print(&quot;run_id: {}; lifecycle_stage: {}&quot;.format(run_id,</span>
<span class="sd">            mlflow.get_run(run_id).info.lifecycle_stage))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        run_id: 7472befefc754e388e8e922824a0cca5; lifecycle_stage: active</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_param"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_param">[docs]</a><span class="k">def</span> <span class="nf">log_param</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a parameter under the current run. If no run is active, this method will create</span>
<span class="sd">    a new active run.</span>

<span class="sd">    :param key: Parameter name (string). This string may only contain alphanumerics,</span>
<span class="sd">                underscores (_), dashes (-), periods (.), spaces ( ), and slashes (/).</span>
<span class="sd">                All backend stores will support keys up to length 250, but some may</span>
<span class="sd">                support larger keys.</span>
<span class="sd">    :param value: Parameter value (string, but will be string-ified if not).</span>
<span class="sd">                  All backend stores will support values up to length 5000, but some</span>
<span class="sd">                  may support larger values.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_param(&quot;learning_rate&quot;, 0.01)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_tag"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.set_tag">[docs]</a><span class="k">def</span> <span class="nf">set_tag</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set a tag under the current run. If no run is active, this method will create a</span>
<span class="sd">    new active run.</span>

<span class="sd">    :param key: Tag name (string). This string may only contain alphanumerics, underscores</span>
<span class="sd">                (_), dashes (-), periods (.), spaces ( ), and slashes (/).</span>
<span class="sd">                All backend stores will support keys up to length 250, but some may</span>
<span class="sd">                support larger keys.</span>
<span class="sd">    :param value: Tag value (string, but will be string-ified if not).</span>
<span class="sd">                  All backend stores will support values up to length 5000, but some</span>
<span class="sd">                  may support larger values.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">           mlflow.set_tag(&quot;release.version&quot;, &quot;2.2.0&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="delete_tag"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.delete_tag">[docs]</a><span class="k">def</span> <span class="nf">delete_tag</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a tag from a run. This is irreversible. If no run is active, this method</span>
<span class="sd">    will create a new active run.</span>

<span class="sd">    :param key: Name of the tag</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        tags = {&quot;engineering&quot;: &quot;ML Platform&quot;,</span>
<span class="sd">                &quot;engineering_remote&quot;: &quot;ML Platform&quot;}</span>

<span class="sd">        with mlflow.start_run() as run:</span>
<span class="sd">            mlflow.set_tags(tags)</span>

<span class="sd">        with mlflow.start_run(run_id=run.info.run_id):</span>
<span class="sd">            mlflow.delete_tag(&quot;engineering_remote&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">delete_tag</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_metric"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_metric">[docs]</a><span class="k">def</span> <span class="nf">log_metric</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a metric under the current run. If no run is active, this method will create</span>
<span class="sd">    a new active run.</span>

<span class="sd">    :param key: Metric name (string). This string may only contain alphanumerics, underscores (_),</span>
<span class="sd">                dashes (-), periods (.), spaces ( ), and slashes (/).</span>
<span class="sd">                All backend stores will support keys up to length 250, but some may</span>
<span class="sd">                support larger keys.</span>
<span class="sd">    :param value: Metric value (float). Note that some special values such as +/- Infinity may be</span>
<span class="sd">                  replaced by other values depending on the store. For example, the</span>
<span class="sd">                  SQLAlchemy store replaces +/- Infinity with max / min float values.</span>
<span class="sd">                  All backend stores will support values up to length 5000, but some</span>
<span class="sd">                  may support larger values.</span>
<span class="sd">    :param step: Metric step (int). Defaults to zero if unspecified.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_metric(&quot;mse&quot;, 2500.00)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">step</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_metrics"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_metrics">[docs]</a><span class="k">def</span> <span class="nf">log_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">step</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log multiple metrics for the current run. If no run is active, this method will create a new</span>
<span class="sd">    active run.</span>

<span class="sd">    :param metrics: Dictionary of metric_name: String -&gt; value: Float. Note that some special</span>
<span class="sd">                    values such as +/- Infinity may be replaced by other values depending on</span>
<span class="sd">                    the store. For example, sql based store may replace +/- Infinity with</span>
<span class="sd">                    max / min float values.</span>
<span class="sd">    :param step: A single integer step at which to log the specified</span>
<span class="sd">                 Metrics. If unspecified, each metric is logged at step zero.</span>

<span class="sd">    :returns: None</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        metrics = {&quot;mse&quot;: 2500.00, &quot;rmse&quot;: 50.00}</span>

<span class="sd">        # Log a batch of metrics</span>
<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_metrics(metrics)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">metrics_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metric</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">step</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_batch</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics_arr</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[],</span> <span class="n">tags</span><span class="o">=</span><span class="p">[])</span></div>


<div class="viewcode-block" id="log_params"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_params">[docs]</a><span class="k">def</span> <span class="nf">log_params</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a batch of params for the current run. If no run is active, this method will create a</span>
<span class="sd">    new active run.</span>

<span class="sd">    :param params: Dictionary of param_name: String -&gt; value: (String, but will be string-ified if</span>
<span class="sd">                   not)</span>
<span class="sd">    :returns: None</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        params = {&quot;learning_rate&quot;: 0.01, &quot;n_estimators&quot;: 10}</span>

<span class="sd">        # Log a batch of parameters</span>
<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_params(params)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">params_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">Param</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_batch</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[],</span> <span class="n">params</span><span class="o">=</span><span class="n">params_arr</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[])</span></div>


<div class="viewcode-block" id="set_tags"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.set_tags">[docs]</a><span class="k">def</span> <span class="nf">set_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a batch of tags for the current run. If no run is active, this method will create a</span>
<span class="sd">    new active run.</span>

<span class="sd">    :param tags: Dictionary of tag_name: String -&gt; value: (String, but will be string-ified if</span>
<span class="sd">                 not)</span>
<span class="sd">    :returns: None</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        tags = {&quot;engineering&quot;: &quot;ML Platform&quot;,</span>
<span class="sd">                &quot;release.candidate&quot;: &quot;RC1&quot;,</span>
<span class="sd">                &quot;release.version&quot;: &quot;2.2.0&quot;}</span>

<span class="sd">        # Set a batch of tags</span>
<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.set_tags(tags)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">tags_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">RunTag</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_batch</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[],</span> <span class="n">params</span><span class="o">=</span><span class="p">[],</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags_arr</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_artifact"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_artifact">[docs]</a><span class="k">def</span> <span class="nf">log_artifact</span><span class="p">(</span><span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">artifact_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a local file or directory as an artifact of the currently active run. If no run is</span>
<span class="sd">    active, this method will create a new active run.</span>

<span class="sd">    :param local_path: Path to the file to write.</span>
<span class="sd">    :param artifact_path: If provided, the directory in ``artifact_uri`` to write to.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        # Create a features.txt artifact file</span>
<span class="sd">        features = &quot;rooms, zipcode, median_price, school_rating, transport&quot;</span>
<span class="sd">        with open(&quot;features.txt&quot;, &#39;w&#39;) as f:</span>
<span class="sd">            f.write(features)</span>

<span class="sd">        # With artifact_path=None write features.txt under</span>
<span class="sd">        # root artifact_uri/artifacts directory</span>
<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_artifact(&quot;features.txt&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">artifact_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_artifacts"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_artifacts">[docs]</a><span class="k">def</span> <span class="nf">log_artifacts</span><span class="p">(</span><span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">artifact_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log all the contents of a local directory as artifacts of the run. If no run is active,</span>
<span class="sd">    this method will create a new active run.</span>

<span class="sd">    :param local_dir: Path to the directory of files to write.</span>
<span class="sd">    :param artifact_path: If provided, the directory in ``artifact_uri`` to write to.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import os</span>
<span class="sd">        import mlflow</span>

<span class="sd">        # Create some files to preserve as artifacts</span>
<span class="sd">        features = &quot;rooms, zipcode, median_price, school_rating, transport&quot;</span>
<span class="sd">        data = {&quot;state&quot;: &quot;TX&quot;, &quot;Available&quot;: 25, &quot;Type&quot;: &quot;Detached&quot;}</span>

<span class="sd">        # Create couple of artifact files under the directory &quot;data&quot;</span>
<span class="sd">        os.makedirs(&quot;data&quot;, exist_ok=True)</span>
<span class="sd">        with open(&quot;data/data.json&quot;, &#39;w&#39;, encoding=&#39;utf-8&#39;) as f:</span>
<span class="sd">            json.dump(data, f, indent=2)</span>
<span class="sd">        with open(&quot;data/features.txt&quot;, &#39;w&#39;) as f:</span>
<span class="sd">            f.write(features)</span>

<span class="sd">        # Write all files in &quot;data&quot; to root artifact_uri/states</span>
<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_artifacts(&quot;data&quot;, artifact_path=&quot;states&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_artifacts</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">,</span> <span class="n">artifact_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_text"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_text">[docs]</a><span class="k">def</span> <span class="nf">log_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">artifact_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log text as an artifact.</span>

<span class="sd">    :param text: String containing text to log.</span>
<span class="sd">    :param artifact_file: The run-relative artifact file path in posixpath format to which</span>
<span class="sd">                          the text is saved (e.g. &quot;dir/file.txt&quot;).</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            # Log text to a file under the run&#39;s root artifact directory</span>
<span class="sd">            mlflow.log_text(&quot;text1&quot;, &quot;file1.txt&quot;)</span>

<span class="sd">            # Log text in a subdirectory of the run&#39;s root artifact directory</span>
<span class="sd">            mlflow.log_text(&quot;text2&quot;, &quot;dir/file2.txt&quot;)</span>

<span class="sd">            # Log HTML text</span>
<span class="sd">            mlflow.log_text(&quot;&lt;h1&gt;header&lt;/h1&gt;&quot;, &quot;index.html&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_text</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">artifact_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_dict"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_dict">[docs]</a><span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="n">dictionary</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">artifact_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a JSON/YAML-serializable object (e.g. `dict`) as an artifact. The serialization</span>
<span class="sd">    format (JSON or YAML) is automatically inferred from the extension of `artifact_file`.</span>
<span class="sd">    If the file extension doesn&#39;t exist or match any of [&quot;.json&quot;, &quot;.yml&quot;, &quot;.yaml&quot;],</span>
<span class="sd">    JSON format is used.</span>

<span class="sd">    :param dictionary: Dictionary to log.</span>
<span class="sd">    :param artifact_file: The run-relative artifact file path in posixpath format to which</span>
<span class="sd">                          the dictionary is saved (e.g. &quot;dir/data.json&quot;).</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        dictionary = {&quot;k&quot;: &quot;v&quot;}</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            # Log a dictionary as a JSON file under the run&#39;s root artifact directory</span>
<span class="sd">            mlflow.log_dict(dictionary, &quot;data.json&quot;)</span>

<span class="sd">            # Log a dictionary as a YAML file in a subdirectory of the run&#39;s root artifact directory</span>
<span class="sd">            mlflow.log_dict(dictionary, &quot;dir/data.yml&quot;)</span>

<span class="sd">            # If the file extension doesn&#39;t exist or match any of [&quot;.json&quot;, &quot;.yaml&quot;, &quot;.yml&quot;],</span>
<span class="sd">            # JSON format is used.</span>
<span class="sd">            mlflow.log_dict(dictionary, &quot;data&quot;)</span>
<span class="sd">            mlflow.log_dict(dictionary, &quot;data.txt&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">artifact_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_figure"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_figure">[docs]</a><span class="k">def</span> <span class="nf">log_figure</span><span class="p">(</span>
    <span class="n">figure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;matplotlib.figure.Figure&quot;</span><span class="p">,</span> <span class="s2">&quot;plotly.graph_objects.Figure&quot;</span><span class="p">],</span> <span class="n">artifact_file</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a figure as an artifact. The following figure objects are supported:</span>

<span class="sd">    - `matplotlib.figure.Figure`_</span>
<span class="sd">    - `plotly.graph_objects.Figure`_</span>

<span class="sd">    .. _matplotlib.figure.Figure:</span>
<span class="sd">        https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html</span>

<span class="sd">    .. _plotly.graph_objects.Figure:</span>
<span class="sd">        https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html</span>

<span class="sd">    :param figure: Figure to log.</span>
<span class="sd">    :param artifact_file: The run-relative artifact file path in posixpath format to which</span>
<span class="sd">                          the figure is saved (e.g. &quot;dir/file.png&quot;).</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Matplotlib Example</span>

<span class="sd">        import mlflow</span>
<span class="sd">        import matplotlib.pyplot as plt</span>

<span class="sd">        fig, ax = plt.subplots()</span>
<span class="sd">        ax.plot([0, 1], [2, 3])</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_figure(fig, &quot;figure.png&quot;)</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Plotly Example</span>

<span class="sd">        import mlflow</span>
<span class="sd">        from plotly import graph_objects as go</span>

<span class="sd">        fig = go.Figure(go.Scatter(x=[0, 1], y=[2, 3]))</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_figure(fig, &quot;figure.html&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_figure</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">artifact_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="log_image"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.log_image">[docs]</a><span class="k">def</span> <span class="nf">log_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;numpy.ndarray&quot;</span><span class="p">,</span> <span class="s2">&quot;PIL.Image.Image&quot;</span><span class="p">],</span> <span class="n">artifact_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log an image as an artifact. The following image objects are supported:</span>

<span class="sd">    - `numpy.ndarray`_</span>
<span class="sd">    - `PIL.Image.Image`_</span>

<span class="sd">    .. _numpy.ndarray:</span>
<span class="sd">        https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html</span>

<span class="sd">    .. _PIL.Image.Image:</span>
<span class="sd">        https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.Image</span>

<span class="sd">    Numpy array support</span>
<span class="sd">        - data type (( ) represents a valid value range):</span>

<span class="sd">            - bool</span>
<span class="sd">            - integer (0 ~ 255)</span>
<span class="sd">            - unsigned integer (0 ~ 255)</span>
<span class="sd">            - float (0.0 ~ 1.0)</span>

<span class="sd">            .. warning::</span>

<span class="sd">                - Out-of-range integer values will be **clipped** to [0, 255].</span>
<span class="sd">                - Out-of-range float values will be **clipped** to [0, 1].</span>

<span class="sd">        - shape (H: height, W: width):</span>

<span class="sd">            - H x W (Grayscale)</span>
<span class="sd">            - H x W x 1 (Grayscale)</span>
<span class="sd">            - H x W x 3 (an RGB channel order is assumed)</span>
<span class="sd">            - H x W x 4 (an RGBA channel order is assumed)</span>

<span class="sd">    :param image: Image to log.</span>
<span class="sd">    :param artifact_file: The run-relative artifact file path in posixpath format to which</span>
<span class="sd">                          the image is saved (e.g. &quot;dir/image.png&quot;).</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Numpy Example</span>

<span class="sd">        import mlflow</span>
<span class="sd">        import numpy as np</span>

<span class="sd">        image = np.random.randint(0, 256, size=(100, 100, 3), dtype=np.uint8)</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_image(image, &quot;image.png&quot;)</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Pillow Example</span>

<span class="sd">        import mlflow</span>
<span class="sd">        from PIL import Image</span>

<span class="sd">        image = Image.new(&quot;RGB&quot;, (100, 100))</span>

<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_image(image, &quot;image.png&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">artifact_file</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_record_logged_model</span><span class="p">(</span><span class="n">mlflow_model</span><span class="p">):</span>
    <span class="n">run_id</span> <span class="o">=</span> <span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">_record_logged_model</span><span class="p">(</span><span class="n">run_id</span><span class="p">,</span> <span class="n">mlflow_model</span><span class="p">)</span>


<div class="viewcode-block" id="get_experiment"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.get_experiment">[docs]</a><span class="k">def</span> <span class="nf">get_experiment</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Experiment</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve an experiment by experiment_id from the backend store</span>

<span class="sd">    :param experiment_id: The string-ified experiment ID returned from ``create_experiment``.</span>
<span class="sd">    :return: :py:class:`mlflow.entities.Experiment`</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        experiment = mlflow.get_experiment(&quot;0&quot;)</span>
<span class="sd">        print(&quot;Name: {}&quot;.format(experiment.name))</span>
<span class="sd">        print(&quot;Artifact Location: {}&quot;.format(experiment.artifact_location))</span>
<span class="sd">        print(&quot;Tags: {}&quot;.format(experiment.tags))</span>
<span class="sd">        print(&quot;Lifecycle_stage: {}&quot;.format(experiment.lifecycle_stage))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Name: Default</span>
<span class="sd">        Artifact Location: file:///.../mlruns/0</span>
<span class="sd">        Tags: {}</span>
<span class="sd">        Lifecycle_stage: active</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">get_experiment</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_experiment_by_name"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.get_experiment_by_name">[docs]</a><span class="k">def</span> <span class="nf">get_experiment_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Experiment</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve an experiment by experiment name from the backend store</span>

<span class="sd">    :param name: The case senstive experiment name.</span>
<span class="sd">    :return: An instance of :py:class:`mlflow.entities.Experiment`</span>
<span class="sd">             if an experiment with the specified name exists, otherwise None.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        # Case sensitive name</span>
<span class="sd">        experiment = mlflow.get_experiment_by_name(&quot;Default&quot;)</span>
<span class="sd">        print(&quot;Experiment_id: {}&quot;.format(experiment.experiment_id))</span>
<span class="sd">        print(&quot;Artifact Location: {}&quot;.format(experiment.artifact_location))</span>
<span class="sd">        print(&quot;Tags: {}&quot;.format(experiment.tags))</span>
<span class="sd">        print(&quot;Lifecycle_stage: {}&quot;.format(experiment.lifecycle_stage))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Experiment_id: 0</span>
<span class="sd">        Artifact Location: file:///.../mlruns/0</span>
<span class="sd">        Tags: {}</span>
<span class="sd">        Lifecycle_stage: active</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="list_experiments"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.list_experiments">[docs]</a><span class="k">def</span> <span class="nf">list_experiments</span><span class="p">(</span>
    <span class="n">view_type</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ViewType</span><span class="o">.</span><span class="n">ACTIVE_ONLY</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Experiment</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param view_type: Qualify requested type of experiments.</span>
<span class="sd">    :param max_results: If passed, specifies the maximum number of experiments desired. If not</span>
<span class="sd">                        passed, all experiments will be returned.</span>
<span class="sd">    :return: A list of :py:class:`Experiment &lt;mlflow.entities.Experiment&gt;` objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">pagination_wrapper_func</span><span class="p">(</span><span class="n">number_to_get</span><span class="p">,</span> <span class="n">next_page_token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">list_experiments</span><span class="p">(</span>
            <span class="n">view_type</span><span class="o">=</span><span class="n">view_type</span><span class="p">,</span>
            <span class="n">max_results</span><span class="o">=</span><span class="n">number_to_get</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">next_page_token</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">_paginate</span><span class="p">(</span><span class="n">pagination_wrapper_func</span><span class="p">,</span> <span class="n">SEARCH_MAX_RESULTS_DEFAULT</span><span class="p">,</span> <span class="n">max_results</span><span class="p">)</span></div>


<div class="viewcode-block" id="create_experiment"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.create_experiment">[docs]</a><span class="k">def</span> <span class="nf">create_experiment</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">artifact_location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an experiment.</span>

<span class="sd">    :param name: The experiment name, which must be unique and is case sensitive</span>
<span class="sd">    :param artifact_location: The location to store run artifacts.</span>
<span class="sd">                              If not provided, the server picks an appropriate default.</span>
<span class="sd">    :param tags: An optional dictionary of string keys and values to set as</span>
<span class="sd">                            tags on the experiment.</span>
<span class="sd">    :return: String ID of the created experiment.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        # Create an experiment name, which must be unique and case sensitive</span>
<span class="sd">        experiment_id = mlflow.create_experiment(&quot;Social NLP Experiments&quot;)</span>
<span class="sd">        experiment = mlflow.get_experiment(experiment_id)</span>
<span class="sd">        print(&quot;Name: {}&quot;.format(experiment.name))</span>
<span class="sd">        print(&quot;Experiment_id: {}&quot;.format(experiment.experiment_id))</span>
<span class="sd">        print(&quot;Artifact Location: {}&quot;.format(experiment.artifact_location))</span>
<span class="sd">        print(&quot;Tags: {}&quot;.format(experiment.tags))</span>
<span class="sd">        print(&quot;Lifecycle_stage: {}&quot;.format(experiment.lifecycle_stage))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Name: Social NLP Experiments</span>
<span class="sd">        Experiment_id: 1</span>
<span class="sd">        Artifact Location: file:///.../mlruns/1</span>
<span class="sd">        Tags= {}</span>
<span class="sd">        Lifecycle_stage: active</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">artifact_location</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span></div>


<div class="viewcode-block" id="delete_experiment"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.delete_experiment">[docs]</a><span class="k">def</span> <span class="nf">delete_experiment</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an experiment from the backend store.</span>

<span class="sd">    :param experiment_id: The The string-ified experiment ID returned from ``create_experiment``.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        experiment_id = mlflow.create_experiment(&quot;New Experiment&quot;)</span>
<span class="sd">        mlflow.delete_experiment(experiment_id)</span>

<span class="sd">        # Examine the deleted experiment details.</span>
<span class="sd">        experiment = mlflow.get_experiment(experiment_id)</span>
<span class="sd">        print(&quot;Name: {}&quot;.format(experiment.name))</span>
<span class="sd">        print(&quot;Artifact Location: {}&quot;.format(experiment.artifact_location))</span>
<span class="sd">        print(&quot;Lifecycle_stage: {}&quot;.format(experiment.lifecycle_stage))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Name: New Experiment</span>
<span class="sd">        Artifact Location: file:///.../mlruns/2</span>
<span class="sd">        Lifecycle_stage: deleted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">delete_experiment</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="delete_run"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.delete_run">[docs]</a><span class="k">def</span> <span class="nf">delete_run</span><span class="p">(</span><span class="n">run_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes a run with the given ID.</span>

<span class="sd">    :param run_id: Unique identifier for the run to delete.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        with mlflow.start_run() as run:</span>
<span class="sd">            mlflow.log_param(&quot;p&quot;, 0)</span>

<span class="sd">        run_id = run.info.run_id</span>
<span class="sd">        mlflow.delete_run(run_id)</span>

<span class="sd">        print(&quot;run_id: {}; lifecycle_stage: {}&quot;.format(run_id,</span>
<span class="sd">            mlflow.get_run(run_id).info.lifecycle_stage))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        run_id: 45f4af3e6fd349e58579b27fcb0b8277; lifecycle_stage: deleted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">delete_run</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_artifact_uri"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.get_artifact_uri">[docs]</a><span class="k">def</span> <span class="nf">get_artifact_uri</span><span class="p">(</span><span class="n">artifact_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the absolute URI of the specified artifact in the currently active run.</span>
<span class="sd">    If `path` is not specified, the artifact root URI of the currently active</span>
<span class="sd">    run will be returned; calls to ``log_artifact`` and ``log_artifacts`` write</span>
<span class="sd">    artifact(s) to subdirectories of the artifact root URI.</span>

<span class="sd">    If no run is active, this method will create a new active run.</span>

<span class="sd">    :param artifact_path: The run-relative artifact path for which to obtain an absolute URI.</span>
<span class="sd">                          For example, &quot;path/to/artifact&quot;. If unspecified, the artifact root URI</span>
<span class="sd">                          for the currently active run will be returned.</span>
<span class="sd">    :return: An *absolute* URI referring to the specified artifact or the currently adtive run&#39;s</span>
<span class="sd">             artifact root. For example, if an artifact path is provided and the currently active</span>
<span class="sd">             run uses an S3-backed store, this may be a uri of the form</span>
<span class="sd">             ``s3://&lt;bucket_name&gt;/path/to/artifact/root/path/to/artifact``. If an artifact path</span>
<span class="sd">             is not provided and the currently active run uses an S3-backed store, this may be a</span>
<span class="sd">             URI of the form ``s3://&lt;bucket_name&gt;/path/to/artifact/root``.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        features = &quot;rooms, zipcode, median_price, school_rating, transport&quot;</span>
<span class="sd">        with open(&quot;features.txt&quot;, &#39;w&#39;) as f:</span>
<span class="sd">            f.write(features)</span>

<span class="sd">        # Log the artifact in a directory &quot;features&quot; under the root artifact_uri/features</span>
<span class="sd">        with mlflow.start_run():</span>
<span class="sd">            mlflow.log_artifact(&quot;features.txt&quot;, artifact_path=&quot;features&quot;)</span>

<span class="sd">            # Fetch the artifact uri root directory</span>
<span class="sd">            artifact_uri = mlflow.get_artifact_uri()</span>
<span class="sd">            print(&quot;Artifact uri: {}&quot;.format(artifact_uri))</span>

<span class="sd">            # Fetch a specific artifact uri</span>
<span class="sd">            artifact_uri = mlflow.get_artifact_uri(artifact_path=&quot;features/features.txt&quot;)</span>
<span class="sd">            print(&quot;Artifact uri: {}&quot;.format(artifact_uri))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Artifact uri: file:///.../0/a46a80f1c9644bd8f4e5dd5553fffce/artifacts</span>
<span class="sd">        Artifact uri: file:///.../0/a46a80f1c9644bd8f4e5dd5553fffce/artifacts/features/features.txt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">artifact_utils</span><span class="o">.</span><span class="n">get_artifact_uri</span><span class="p">(</span>
        <span class="n">run_id</span><span class="o">=</span><span class="n">_get_or_start_run</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="n">artifact_path</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="search_runs"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.search_runs">[docs]</a><span class="k">def</span> <span class="nf">search_runs</span><span class="p">(</span>
    <span class="n">experiment_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filter_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">run_view_type</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ViewType</span><span class="o">.</span><span class="n">ACTIVE_ONLY</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">SEARCH_MAX_RESULTS_PANDAS</span><span class="p">,</span>
    <span class="n">order_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pandas&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Run</span><span class="p">],</span> <span class="s2">&quot;pandas.DataFrame&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a pandas DataFrame of runs that fit the search criteria.</span>

<span class="sd">    :param experiment_ids: List of experiment IDs. None will default to the active experiment.</span>
<span class="sd">    :param filter_string: Filter query string, defaults to searching all runs.</span>
<span class="sd">    :param run_view_type: one of enum values ``ACTIVE_ONLY``, ``DELETED_ONLY``, or ``ALL`` runs</span>
<span class="sd">                            defined in :py:class:`mlflow.entities.ViewType`.</span>
<span class="sd">    :param max_results: The maximum number of runs to put in the dataframe. Default is 100,000</span>
<span class="sd">                        to avoid causing out-of-memory issues on the user&#39;s machine.</span>
<span class="sd">    :param order_by: List of columns to order by (e.g., &quot;metrics.rmse&quot;). The ``order_by`` column</span>
<span class="sd">                     can contain an optional ``DESC`` or ``ASC`` value. The default is ``ASC``.</span>
<span class="sd">                     The default ordering is to sort by ``start_time DESC``, then ``run_id``.</span>
<span class="sd">    :param output_format: The output format to be returned. If ``pandas``, a ``pandas.DataFrame``</span>
<span class="sd">                          is returned and, if ``list``, a list of :py:class:`mlflow.entities.Run`</span>
<span class="sd">                          is returned.</span>

<span class="sd">    :return: If output_format is ``list``: a list of :py:class:`mlflow.entities.Run`. If</span>
<span class="sd">             output_format is ``pandas``: ``pandas.DataFrame`` of runs, where each metric,</span>
<span class="sd">             parameter, and tag is expanded into its own column named metrics.*, params.*, or</span>
<span class="sd">             tags.* respectively. For runs that don&#39;t have a particular metric, parameter, or tag,</span>
<span class="sd">             the value for the corresponding column is (NumPy) ``Nan``, ``None``, or ``None``</span>
<span class="sd">             respectively.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>

<span class="sd">        # Create an experiment and log two runs under it</span>
<span class="sd">        experiment_id = mlflow.create_experiment(&quot;Social NLP Experiments&quot;)</span>
<span class="sd">        with mlflow.start_run(experiment_id=experiment_id):</span>
<span class="sd">            mlflow.log_metric(&quot;m&quot;, 1.55)</span>
<span class="sd">            mlflow.set_tag(&quot;s.release&quot;, &quot;1.1.0-RC&quot;)</span>
<span class="sd">        with mlflow.start_run(experiment_id=experiment_id):</span>
<span class="sd">            mlflow.log_metric(&quot;m&quot;, 2.50)</span>
<span class="sd">            mlflow.set_tag(&quot;s.release&quot;, &quot;1.2.0-GA&quot;)</span>

<span class="sd">        # Search all runs in experiment_id</span>
<span class="sd">        df = mlflow.search_runs([experiment_id], order_by=[&quot;metrics.m DESC&quot;])</span>
<span class="sd">        print(df[[&quot;metrics.m&quot;, &quot;tags.s.release&quot;, &quot;run_id&quot;]])</span>
<span class="sd">        print(&quot;--&quot;)</span>

<span class="sd">        # Search the experiment_id using a filter_string with tag</span>
<span class="sd">        # that has a case insensitive pattern</span>
<span class="sd">        filter_string = &quot;tags.s.release ILIKE &#39;%rc%&#39;&quot;</span>
<span class="sd">        df = mlflow.search_runs([experiment_id], filter_string=filter_string)</span>
<span class="sd">        print(df[[&quot;metrics.m&quot;, &quot;tags.s.release&quot;, &quot;run_id&quot;]])</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">           metrics.m tags.s.release                            run_id</span>
<span class="sd">        0       2.50       1.2.0-GA  147eed886ab44633902cc8e19b2267e2</span>
<span class="sd">        1       1.55       1.1.0-RC  5cc7feaf532f496f885ad7750809c4d4</span>
<span class="sd">        --</span>
<span class="sd">           metrics.m tags.s.release                            run_id</span>
<span class="sd">        0       1.55       1.1.0-RC  5cc7feaf532f496f885ad7750809c4d4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">experiment_ids</span><span class="p">:</span>
        <span class="n">experiment_ids</span> <span class="o">=</span> <span class="n">_get_experiment_id</span><span class="p">()</span>

    <span class="c1"># Using an internal function as the linter doesn&#39;t like assigning a lambda, and inlining the</span>
    <span class="c1"># full thing is a mess</span>
    <span class="k">def</span> <span class="nf">pagination_wrapper_func</span><span class="p">(</span><span class="n">number_to_get</span><span class="p">,</span> <span class="n">next_page_token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">search_runs</span><span class="p">(</span>
            <span class="n">experiment_ids</span><span class="p">,</span>
            <span class="n">filter_string</span><span class="p">,</span>
            <span class="n">run_view_type</span><span class="p">,</span>
            <span class="n">number_to_get</span><span class="p">,</span>
            <span class="n">order_by</span><span class="p">,</span>
            <span class="n">next_page_token</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">runs</span> <span class="o">=</span> <span class="n">_paginate</span><span class="p">(</span><span class="n">pagination_wrapper_func</span><span class="p">,</span> <span class="n">NUM_RUNS_PER_PAGE_PANDAS</span><span class="p">,</span> <span class="n">max_results</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">runs</span>  <span class="c1"># List[mlflow.entities.run.Run]</span>
    <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;pandas&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;run_id&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;experiment_id&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;artifact_uri&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">tags</span> <span class="o">=</span> <span class="p">({},</span> <span class="p">{},</span> <span class="p">{})</span>
        <span class="n">PARAM_NULL</span><span class="p">,</span> <span class="n">METRIC_NULL</span><span class="p">,</span> <span class="n">TAG_NULL</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;run_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">run_id</span><span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;experiment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">experiment_id</span><span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;artifact_uri&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">artifact_uri</span><span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

            <span class="c1"># Params</span>
            <span class="n">param_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">param_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PARAM_NULL</span><span class="p">)</span>
            <span class="n">new_params</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">param_keys</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">new_params</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">PARAM_NULL</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>  <span class="c1"># Fill in null values for all previous runs</span>
                <span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>

            <span class="c1"># Metrics</span>
            <span class="n">metric_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metric_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">METRIC_NULL</span><span class="p">)</span>
            <span class="n">new_metrics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">metric_keys</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">new_metrics</span><span class="p">:</span>
                <span class="n">metrics</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">METRIC_NULL</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>
                <span class="n">metrics</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>

            <span class="c1"># Tags</span>
            <span class="n">tag_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tag_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="n">tags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TAG_NULL</span><span class="p">)</span>
            <span class="n">new_tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">tag_keys</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">new_tags</span><span class="p">:</span>
                <span class="n">tags</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">TAG_NULL</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>
                <span class="n">tags</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;metrics.&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params.&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tags.&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Unsupported output format: </span><span class="si">%s</span><span class="s2">. Supported string values are &#39;pandas&#39; or &#39;list&#39;&quot;</span>
            <span class="o">%</span> <span class="n">output_format</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="list_run_infos"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.list_run_infos">[docs]</a><span class="k">def</span> <span class="nf">list_run_infos</span><span class="p">(</span>
    <span class="n">experiment_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">run_view_type</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">ViewType</span><span class="o">.</span><span class="n">ACTIVE_ONLY</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">SEARCH_MAX_RESULTS_DEFAULT</span><span class="p">,</span>
    <span class="n">order_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">RunInfo</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return run information for runs which belong to the experiment_id.</span>

<span class="sd">    :param experiment_id: The experiment id which to search</span>
<span class="sd">    :param run_view_type: ACTIVE_ONLY, DELETED_ONLY, or ALL runs</span>
<span class="sd">    :param max_results: Maximum number of results desired.</span>
<span class="sd">    :param order_by: List of order_by clauses. Currently supported values are</span>
<span class="sd">           are ``metric.key``, ``parameter.key``, ``tag.key``, ``attribute.key``.</span>
<span class="sd">           For example, ``order_by=[&quot;tag.release ASC&quot;, &quot;metric.click_rate DESC&quot;]``.</span>

<span class="sd">    :return: A list of :py:class:`RunInfo &lt;mlflow.entities.RunInfo&gt;` objects that satisfy the</span>
<span class="sd">        search expressions.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import mlflow</span>
<span class="sd">        from mlflow.entities import ViewType</span>

<span class="sd">        # Create two runs</span>
<span class="sd">        with mlflow.start_run() as run1:</span>
<span class="sd">            mlflow.log_param(&quot;p&quot;, 0)</span>

<span class="sd">        with mlflow.start_run() as run2:</span>
<span class="sd">            mlflow.log_param(&quot;p&quot;, 1)</span>

<span class="sd">        # Delete the last run</span>
<span class="sd">        mlflow.delete_run(run2.info.run_id)</span>

<span class="sd">        def print_run_infos(run_infos):</span>
<span class="sd">            for r in run_infos:</span>
<span class="sd">                print(&quot;- run_id: {}, lifecycle_stage: {}&quot;.format(r.run_id, r.lifecycle_stage))</span>

<span class="sd">        print(&quot;Active runs:&quot;)</span>
<span class="sd">        print_run_infos(mlflow.list_run_infos(&quot;0&quot;, run_view_type=ViewType.ACTIVE_ONLY))</span>

<span class="sd">        print(&quot;Deleted runs:&quot;)</span>
<span class="sd">        print_run_infos(mlflow.list_run_infos(&quot;0&quot;, run_view_type=ViewType.DELETED_ONLY))</span>

<span class="sd">        print(&quot;All runs:&quot;)</span>
<span class="sd">        print_run_infos(mlflow.list_run_infos(&quot;0&quot;, run_view_type=ViewType.ALL))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        Active runs:</span>
<span class="sd">        - run_id: 4937823b730640d5bed9e3e5057a2b34, lifecycle_stage: active</span>
<span class="sd">        Deleted runs:</span>
<span class="sd">        - run_id: b13f1badbed842cf9975c023d23da300, lifecycle_stage: deleted</span>
<span class="sd">        All runs:</span>
<span class="sd">        - run_id: b13f1badbed842cf9975c023d23da300, lifecycle_stage: deleted</span>
<span class="sd">        - run_id: 4937823b730640d5bed9e3e5057a2b34, lifecycle_stage: active</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Using an internal function as the linter doesn&#39;t like assigning a lambda, and inlining the</span>
    <span class="c1"># full thing is a mess</span>
    <span class="k">def</span> <span class="nf">pagination_wrapper_func</span><span class="p">(</span><span class="n">number_to_get</span><span class="p">,</span> <span class="n">next_page_token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">list_run_infos</span><span class="p">(</span>
            <span class="n">experiment_id</span><span class="p">,</span> <span class="n">run_view_type</span><span class="p">,</span> <span class="n">number_to_get</span><span class="p">,</span> <span class="n">order_by</span><span class="p">,</span> <span class="n">next_page_token</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">_paginate</span><span class="p">(</span><span class="n">pagination_wrapper_func</span><span class="p">,</span> <span class="n">SEARCH_MAX_RESULTS_DEFAULT</span><span class="p">,</span> <span class="n">max_results</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_paginate</span><span class="p">(</span><span class="n">paginated_fn</span><span class="p">,</span> <span class="n">max_results_per_page</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intended to be a general use pagination utility.</span>

<span class="sd">    :param paginated_fn:</span>
<span class="sd">    :type paginated_fn: This function is expected to take in the number of results to retrieve</span>
<span class="sd">        per page and a pagination token, and return a PagedList object</span>
<span class="sd">    :param max_results_per_page:</span>
<span class="sd">    :type max_results_per_page: The maximum number of results to retrieve per page</span>
<span class="sd">    :param max_results:</span>
<span class="sd">    :type max_results: The maximum number of results to retrieve overall. If unspecified,</span>
<span class="sd">                       all results will be retrieved.</span>
<span class="sd">    :return: Returns a list of entities, as determined by the paginated_fn parameter, with no more</span>
<span class="sd">        entities than specified by max_results</span>
<span class="sd">    :rtype: list[object]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">next_page_token</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">returns_all</span> <span class="o">=</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">returns_all</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">:</span>
        <span class="n">num_to_get</span> <span class="o">=</span> <span class="n">max_results_per_page</span> <span class="k">if</span> <span class="n">returns_all</span> <span class="k">else</span> <span class="n">max_results</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_to_get</span> <span class="o">&lt;</span> <span class="n">max_results_per_page</span><span class="p">:</span>
            <span class="n">page_results</span> <span class="o">=</span> <span class="n">paginated_fn</span><span class="p">(</span><span class="n">num_to_get</span><span class="p">,</span> <span class="n">next_page_token</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">page_results</span> <span class="o">=</span> <span class="n">paginated_fn</span><span class="p">(</span><span class="n">max_results_per_page</span><span class="p">,</span> <span class="n">next_page_token</span><span class="p">)</span>
        <span class="n">all_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">page_results</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">page_results</span><span class="p">,</span> <span class="s2">&quot;token&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">page_results</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
            <span class="n">next_page_token</span> <span class="o">=</span> <span class="n">page_results</span><span class="o">.</span><span class="n">token</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">all_results</span>


<span class="k">def</span> <span class="nf">_get_or_start_run</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_active_run_stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_active_run_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">start_run</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_get_experiment_id_from_env</span><span class="p">():</span>
    <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="n">_EXPERIMENT_NAME_ENV_VAR</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">experiment_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">exp</span> <span class="o">=</span> <span class="n">MlflowClient</span><span class="p">()</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exp</span><span class="o">.</span><span class="n">experiment_id</span> <span class="k">if</span> <span class="n">exp</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="n">_EXPERIMENT_ID_ENV_VAR</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_experiment_id</span><span class="p">():</span>
    <span class="c1"># TODO: Replace with None for 1.0, leaving for 0.9.1 release backcompat with existing servers</span>
    <span class="n">deprecated_default_exp_id</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">_active_experiment_id</span>
        <span class="ow">or</span> <span class="n">_get_experiment_id_from_env</span><span class="p">()</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">is_in_databricks_notebook</span><span class="p">()</span> <span class="ow">and</span> <span class="n">get_notebook_id</span><span class="p">())</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="n">deprecated_default_exp_id</span>


<div class="viewcode-block" id="autolog"><a class="viewcode-back" href="../../../python_api/mlflow.html#mlflow.autolog">[docs]</a><span class="nd">@autologging_integration</span><span class="p">(</span><span class="s2">&quot;mlflow&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">autolog</span><span class="p">(</span>
    <span class="n">log_input_examples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">log_model_signatures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">log_models</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">disable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">disable_for_unsupported_versions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># pylint: disable=unused-argument</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enables (or disables) and configures autologging for all supported integrations.</span>

<span class="sd">    The parameters are passed to any autologging integrations that support them.</span>

<span class="sd">    See the :ref:`tracking docs &lt;automatic-logging&gt;` for a list of supported autologging</span>
<span class="sd">    integrations.</span>

<span class="sd">    Note that framework-specific configurations set at any point will take precedence over</span>
<span class="sd">    any configurations set by this function. For example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        mlflow.autolog(log_models=False, exclusive=True)</span>
<span class="sd">        import sklearn</span>

<span class="sd">    would enable autologging for `sklearn` with `log_models=False` and `exclusive=True`,</span>
<span class="sd">    but</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        mlflow.autolog(log_models=False, exclusive=True)</span>
<span class="sd">        import sklearn</span>
<span class="sd">        mlflow.sklearn.autolog(log_models=True)</span>

<span class="sd">    would enable autologging for `sklearn` with `log_models=True` and `exclusive=False`,</span>
<span class="sd">    the latter resulting from the default value for `exclusive` in `mlflow.sklearn.autolog`;</span>
<span class="sd">    other framework autolog functions (e.g. `mlflow.tensorflow.autolog`) would use the</span>
<span class="sd">    configurations set by `mlflow.autolog` (in this instance, `log_models=False`, `exclusive=True`),</span>
<span class="sd">    until they are explicitly called by the user.</span>

<span class="sd">    :param log_input_examples: If ``True``, input examples from training datasets are collected and</span>
<span class="sd">                               logged along with model artifacts during training. If ``False``,</span>
<span class="sd">                               input examples are not logged.</span>
<span class="sd">                               Note: Input examples are MLflow model attributes</span>
<span class="sd">                               and are only collected if ``log_models`` is also ``True``.</span>
<span class="sd">    :param log_model_signatures: If ``True``,</span>
<span class="sd">                                 :py:class:`ModelSignatures &lt;mlflow.models.ModelSignature&gt;`</span>
<span class="sd">                                 describing model inputs and outputs are collected and logged along</span>
<span class="sd">                                 with model artifacts during training. If ``False``, signatures are</span>
<span class="sd">                                 not logged. Note: Model signatures are MLflow model attributes</span>
<span class="sd">                                 and are only collected if ``log_models`` is also ``True``.</span>
<span class="sd">    :param log_models: If ``True``, trained models are logged as MLflow model artifacts.</span>
<span class="sd">                       If ``False``, trained models are not logged.</span>
<span class="sd">                       Input examples and model signatures, which are attributes of MLflow models,</span>
<span class="sd">                       are also omitted when ``log_models`` is ``False``.</span>
<span class="sd">    :param disable: If ``True``, disables all supported autologging integrations. If ``False``,</span>
<span class="sd">                    enables all supported autologging integrations.</span>
<span class="sd">    :param exclusive: If ``True``, autologged content is not logged to user-created fluent runs.</span>
<span class="sd">                      If ``False``, autologged content is logged to the active fluent run,</span>
<span class="sd">                      which may be user-created.</span>
<span class="sd">    :param disable_for_unsupported_versions: If ``True``, disable autologging for versions of</span>
<span class="sd">                      all integration libraries that have not been tested against this version</span>
<span class="sd">                      of the MLflow client or are incompatible.</span>
<span class="sd">    :param silent: If ``True``, suppress all event logs and warnings from MLflow during autologging</span>
<span class="sd">                   setup and training execution. If ``False``, show all events and warnings during</span>
<span class="sd">                   autologging setup and training execution.</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :caption: Example</span>

<span class="sd">        import numpy as np</span>
<span class="sd">        import mlflow.sklearn</span>
<span class="sd">        from mlflow.tracking import MlflowClient</span>
<span class="sd">        from sklearn.linear_model import LinearRegression</span>

<span class="sd">        def print_auto_logged_info(r):</span>
<span class="sd">            tags = {k: v for k, v in r.data.tags.items() if not k.startswith(&quot;mlflow.&quot;)}</span>
<span class="sd">            artifacts = [f.path for f in MlflowClient().list_artifacts(r.info.run_id, &quot;model&quot;)]</span>
<span class="sd">            print(&quot;run_id: {}&quot;.format(r.info.run_id))</span>
<span class="sd">            print(&quot;artifacts: {}&quot;.format(artifacts))</span>
<span class="sd">            print(&quot;params: {}&quot;.format(r.data.params))</span>
<span class="sd">            print(&quot;metrics: {}&quot;.format(r.data.metrics))</span>
<span class="sd">            print(&quot;tags: {}&quot;.format(tags))</span>

<span class="sd">        # prepare training data</span>
<span class="sd">        X = np.array([[1, 1], [1, 2], [2, 2], [2, 3]])</span>
<span class="sd">        y = np.dot(X, np.array([1, 2])) + 3</span>

<span class="sd">        # Auto log all the parameters, metrics, and artifacts</span>
<span class="sd">        mlflow.autolog()</span>
<span class="sd">        model = LinearRegression()</span>
<span class="sd">        with mlflow.start_run() as run:</span>
<span class="sd">            model.fit(X, y)</span>

<span class="sd">        # fetch the auto logged parameters and metrics for ended run</span>
<span class="sd">        print_auto_logged_info(mlflow.get_run(run_id=run.info.run_id))</span>

<span class="sd">    .. code-block:: text</span>
<span class="sd">        :caption: Output</span>

<span class="sd">        run_id: fd10a17d028c47399a55ab8741721ef7</span>
<span class="sd">        artifacts: [&#39;model/MLmodel&#39;, &#39;model/conda.yaml&#39;, &#39;model/model.pkl&#39;]</span>
<span class="sd">        params: {&#39;copy_X&#39;: &#39;True&#39;,</span>
<span class="sd">                 &#39;normalize&#39;: &#39;False&#39;,</span>
<span class="sd">                 &#39;fit_intercept&#39;: &#39;True&#39;,</span>
<span class="sd">                 &#39;n_jobs&#39;: &#39;None&#39;}</span>
<span class="sd">        metrics: {&#39;training_score&#39;: 1.0,</span>
<span class="sd">                  &#39;training_rmse&#39;: 4.440892098500626e-16,</span>
<span class="sd">                  &#39;training_r2_score&#39;: 1.0,</span>
<span class="sd">                  &#39;training_mae&#39;: 2.220446049250313e-16,</span>
<span class="sd">                  &#39;training_mse&#39;: 1.9721522630525295e-31}</span>
<span class="sd">        tags: {&#39;estimator_class&#39;: &#39;sklearn.linear_model._base.LinearRegression&#39;,</span>
<span class="sd">               &#39;estimator_name&#39;: &#39;LinearRegression&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">mlflow</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">tensorflow</span><span class="p">,</span>
        <span class="n">keras</span><span class="p">,</span>
        <span class="n">gluon</span><span class="p">,</span>
        <span class="n">xgboost</span><span class="p">,</span>
        <span class="n">lightgbm</span><span class="p">,</span>
        <span class="n">pyspark</span><span class="p">,</span>
        <span class="n">statsmodels</span><span class="p">,</span>
        <span class="n">spark</span><span class="p">,</span>
        <span class="n">sklearn</span><span class="p">,</span>
        <span class="n">fastai</span><span class="p">,</span>
        <span class="n">pytorch</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">locals_copy</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="c1"># Mapping of library module name to specific autolog function</span>
    <span class="c1"># eg: mxnet.gluon is the actual library, mlflow.gluon.autolog is our autolog function for it</span>
    <span class="n">LIBRARY_TO_AUTOLOG_FN</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;tensorflow&quot;</span><span class="p">:</span> <span class="n">tensorflow</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;keras&quot;</span><span class="p">:</span> <span class="n">keras</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;mxnet.gluon&quot;</span><span class="p">:</span> <span class="n">gluon</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;xgboost&quot;</span><span class="p">:</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;lightgbm&quot;</span><span class="p">:</span> <span class="n">lightgbm</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;statsmodels&quot;</span><span class="p">:</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;sklearn&quot;</span><span class="p">:</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;fastai&quot;</span><span class="p">:</span> <span class="n">fastai</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;pyspark&quot;</span><span class="p">:</span> <span class="n">spark</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="s2">&quot;pyspark.ml&quot;</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">ml</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
        <span class="c1"># TODO: Broaden this beyond pytorch_lightning as we add autologging support for more</span>
        <span class="c1"># Pytorch frameworks under mlflow.pytorch.autolog</span>
        <span class="s2">&quot;pytorch_lightning&quot;</span><span class="p">:</span> <span class="n">pytorch</span><span class="o">.</span><span class="n">autolog</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">CONF_KEY_IS_GLOBALLY_CONFIGURED</span> <span class="o">=</span> <span class="s2">&quot;globally_configured&quot;</span>

    <span class="k">def</span> <span class="nf">get_autologging_params</span><span class="p">(</span><span class="n">autolog_fn</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">needed_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">autolog_fn</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">locals_copy</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">needed_params</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">setup_autologging</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">autolog_fn</span> <span class="o">=</span> <span class="n">LIBRARY_TO_AUTOLOG_FN</span><span class="p">[</span><span class="n">module</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>

            <span class="c1"># Only call integration&#39;s autolog function with `mlflow.autolog` configs</span>
            <span class="c1"># if the integration&#39;s autolog function has not already been called by the user.</span>
            <span class="c1"># Logic is as follows:</span>
            <span class="c1"># - if a previous_config exists, that means either `mlflow.autolog` or</span>
            <span class="c1">#   `mlflow.integration.autolog` was called.</span>
            <span class="c1"># - if the config contains `CONF_KEY_IS_GLOBALLY_CONFIGURED`, the configuration</span>
            <span class="c1">#   was set by `mlflow.autolog`, and so we can safely call `autolog_fn` with</span>
            <span class="c1">#   `autologging_params`.</span>
            <span class="c1"># - if the config doesn&#39;t contain this key, the configuration was set by an</span>
            <span class="c1">#   `mlflow.integration.autolog` call, so we should not call `autolog_fn` with</span>
            <span class="c1">#   new configs.</span>
            <span class="n">prev_config</span> <span class="o">=</span> <span class="n">AUTOLOGGING_INTEGRATIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">autolog_fn</span><span class="o">.</span><span class="n">integration_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prev_config</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">prev_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONF_KEY_IS_GLOBALLY_CONFIGURED</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="n">autologging_params</span> <span class="o">=</span> <span class="n">get_autologging_params</span><span class="p">(</span><span class="n">autolog_fn</span><span class="p">)</span>
            <span class="n">autolog_fn</span><span class="p">(</span><span class="o">**</span><span class="n">autologging_params</span><span class="p">)</span>
            <span class="n">AUTOLOGGING_INTEGRATIONS</span><span class="p">[</span><span class="n">autolog_fn</span><span class="o">.</span><span class="n">integration_name</span><span class="p">][</span>
                <span class="n">CONF_KEY_IS_GLOBALLY_CONFIGURED</span>
            <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">autologging_is_disabled</span><span class="p">(</span>
                <span class="n">autolog_fn</span><span class="o">.</span><span class="n">integration_name</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">autologging_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;silent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Autologging successfully enabled for </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_testing</span><span class="p">():</span>
                <span class="c1"># Raise unexpected exceptions in test mode in order to detect</span>
                <span class="c1"># errors within dependent autologging integrations</span>
                <span class="k">raise</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">autologging_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;silent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Exception raised while enabling autologging for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">module</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="p">)</span>

    <span class="c1"># for each autolog library (except pyspark), register a post-import hook.</span>
    <span class="c1"># this way, we do not send any errors to the user until we know they are using the library.</span>
    <span class="c1"># the post-import hook also retroactively activates for previously-imported libraries.</span>
    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">LIBRARY_TO_AUTOLOG_FN</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span> <span class="s2">&quot;keras&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark&quot;</span><span class="p">,</span> <span class="s2">&quot;pyspark.ml&quot;</span><span class="p">])</span>
    <span class="p">):</span>
        <span class="n">register_post_import_hook</span><span class="p">(</span><span class="n">setup_autologging</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">FULLY_IMPORTED_KERAS</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">TF_AUTOLOG_SETUP_CALLED</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">conditionally_set_up_keras_autologging</span><span class="p">(</span><span class="n">keras_module</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">FULLY_IMPORTED_KERAS</span><span class="p">,</span> <span class="n">TF_AUTOLOG_SETUP_CALLED</span>
        <span class="n">FULLY_IMPORTED_KERAS</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">Version</span><span class="p">(</span><span class="n">keras_module</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;2.6.0&quot;</span><span class="p">):</span>
            <span class="c1"># NB: Keras unconditionally depends on TensorFlow beginning with Version 2.6.0, and</span>
            <span class="c1"># many classes defined in the `keras` module are aliases of classes in the `tf.keras`</span>
            <span class="c1"># module. Accordingly, TensorFlow autologging serves as a replacement for Keras</span>
            <span class="c1"># autologging in Keras &gt;= 2.6.0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">tensorflow</span>

                <span class="n">setup_autologging</span><span class="p">(</span><span class="n">tensorflow</span><span class="p">)</span>
                <span class="n">TF_AUTOLOG_SETUP_CALLED</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to set up TensorFlow autologging for tf.keras models upon&quot;</span>
                    <span class="s2">&quot; Keras library import: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">setup_autologging</span><span class="p">(</span><span class="n">keras_module</span><span class="p">)</span>

    <span class="n">register_post_import_hook</span><span class="p">(</span><span class="n">conditionally_set_up_keras_autologging</span><span class="p">,</span> <span class="s2">&quot;keras&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_up_tensorflow_autologging</span><span class="p">(</span><span class="n">tensorflow_module</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">sys</span>

        <span class="k">nonlocal</span> <span class="n">FULLY_IMPORTED_KERAS</span><span class="p">,</span> <span class="n">TF_AUTOLOG_SETUP_CALLED</span>
        <span class="k">if</span> <span class="s2">&quot;keras&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">FULLY_IMPORTED_KERAS</span><span class="p">:</span>
            <span class="c1"># In Keras &gt;= 2.6.0, importing Keras imports the TensorFlow library, which can</span>
            <span class="c1"># trigger this autologging import hook for TensorFlow before the entire Keras import</span>
            <span class="c1"># procedure is completed. Attempting to set up autologging before the Keras import</span>
            <span class="c1"># procedure has completed will result in a failure due to the unavailability of</span>
            <span class="c1"># certain modules. In this case, we terminate the TensorFlow autologging import hook</span>
            <span class="c1"># and rely on the Keras autologging import hook to successfully set up TensorFlow</span>
            <span class="c1"># autologging for tf.keras models once the Keras import procedure has completed</span>
            <span class="k">return</span>

        <span class="c1"># By design, in Keras &gt;= 2.6.0, Keras needs to enable tensorflow autologging so that</span>
        <span class="c1"># tf.keras models always use tensorflow autologging, rather than vanilla keras autologging.</span>
        <span class="c1"># As a result, Keras autologging must call `mlflow.tensorflow.autolog()` in Keras &gt;= 2.6.0.</span>
        <span class="c1"># Accordingly, we insert this check to ensure that importing tensorflow, which may import</span>
        <span class="c1"># keras, does not enable tensorflow autologging twice.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">TF_AUTOLOG_SETUP_CALLED</span><span class="p">:</span>
            <span class="n">setup_autologging</span><span class="p">(</span><span class="n">tensorflow_module</span><span class="p">)</span>

    <span class="n">register_post_import_hook</span><span class="p">(</span><span class="n">set_up_tensorflow_autologging</span><span class="p">,</span> <span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># for pyspark, we activate autologging immediately, without waiting for a module import.</span>
    <span class="c1"># this is because on Databricks a SparkSession already exists and the user can directly</span>
    <span class="c1">#   interact with it, and this activity should be logged.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pyspark</span> <span class="k">as</span> <span class="nn">pyspark_module</span>
        <span class="kn">import</span> <span class="nn">pyspark.ml</span> <span class="k">as</span> <span class="nn">pyspark_ml_module</span>

        <span class="n">setup_autologging</span><span class="p">(</span><span class="n">pyspark_module</span><span class="p">)</span>
        <span class="n">setup_autologging</span><span class="p">(</span><span class="n">pyspark_ml_module</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ie</span><span class="p">:</span>
        <span class="c1"># if pyspark isn&#39;t installed, a user could potentially install it in the middle</span>
        <span class="c1">#   of their session so we want to enable autologging once they do</span>
        <span class="k">if</span> <span class="s2">&quot;pyspark&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ie</span><span class="p">):</span>
            <span class="n">register_post_import_hook</span><span class="p">(</span><span class="n">setup_autologging</span><span class="p">,</span> <span class="s2">&quot;pyspark&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">register_post_import_hook</span><span class="p">(</span><span class="n">setup_autologging</span><span class="p">,</span> <span class="s2">&quot;pyspark.ml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_testing</span><span class="p">():</span>
            <span class="c1"># Raise unexpected exceptions in test mode in order to detect</span>
            <span class="c1"># errors within dependent autologging integrations</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Exception raised while enabling autologging for spark: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
</pre></div>

              </div>
            </div>
            <footer>
  

  <hr/>

  <div role="contentinfo">
      <p class="copyright">
          &copy; MLflow Project, a Series of LF Projects, LLC. All rights reserved.
      </p>

  </div> 

</footer>
          </div>
        </div>
      </section>
    </main>
  </page>

  


  
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:'../../../',
      VERSION:'1.23.1',
      COLLAPSE_INDEX:false,
      FILE_SUFFIX:'.html',
      HAS_SOURCE:  true
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/underscore.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/languagesections.js"></script>
  

  <script type="text/javascript" src="../../../_static/js/clipboard.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/jquery.waypoints.min.js"></script>

  
  
  
  <script type="text/javascript">var CLIPPY_SVG_PATH = "../../../_static/clippy.svg";</script>
  <script type="text/javascript" src="../../../_static/js/custom.js"></script>
  

  
  
  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.StickyNav.enable();
    });

  </script>
  
 
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-44077918-9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-44077918-9');
</script>


  
    <!-- Algolia Search -->
    <script type="text/javascript">
      var algoliaConfigs = {
        key: 'b6d79a1058f2b3c1ee03bf659ade5a4b',
        index: 'mlflow',
      };
    </script>
    <div id="algolia-wrapper"></div>
    <script src="../../../_static/js/tether.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  
</body>
</html>